<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Back and Forth - Two Player Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        
        body {
            font-family: 'Orbitron', sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%);
            min-height: 100vh;
        }
        
        .neon-border {
            border: 3px solid #00d9ff;
            box-shadow: 0 0 10px #00d9ff, inset 0 0 10px rgba(0, 217, 255, 0.2);
        }
        
        .neon-border-pink {
            border: 3px solid #ff00ff;
            box-shadow: 0 0 10px #ff00ff, inset 0 0 10px rgba(255, 0, 255, 0.2);
        }
        
        .neon-glow {
            text-shadow: 0 0 10px #00d9ff, 0 0 20px #00d9ff, 0 0 30px #00d9ff;
        }
        
        .neon-glow-pink {
            text-shadow: 0 0 10px #ff00ff, 0 0 20px #ff00ff, 0 0 30px #ff00ff;
        }
        
        .letter-btn {
            transition: all 0.3s ease;
            border: 2px solid #00d9ff;
            background: rgba(0, 217, 255, 0.1);
        }
        
        .letter-btn:hover:not(.banned) {
            background: rgba(0, 217, 255, 0.3);
            transform: scale(1.1);
        }
        
        .letter-btn.banned {
            background: rgba(255, 0, 255, 0.3);
            border-color: #ff00ff;
            cursor: not-allowed;
            opacity: 0.5;
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        input, button {
            font-family: 'Orbitron', sans-serif;
        }
        
        .bg-cobalt {
            background-color: #0047ab;
        }
        
        .timer-warning {
            animation: blink 0.5s infinite;
        }
        
        @keyframes blink {
            0%, 50%, 100% { opacity: 1; }
            25%, 75% { opacity: 0.3; }
        }
    </style>
</head>
<body class="text-white">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Updated game title to "Back and Forth" -->
        <h1 class="text-5xl font-bold text-center mb-8 neon-glow">BACK AND FORTH</h1>
        
        <!-- New Setup Phase with category input first -->
        <div id="setupPhase" class="space-y-6">
            <div class="neon-border rounded-lg p-6 bg-black bg-opacity-50">
                <h2 class="text-3xl font-bold text-center mb-4 neon-glow-pink">Setup Game</h2>
                
                <div class="mb-6">
                    <p class="text-center text-lg mb-4">Enter Category</p>
                    <input type="text" id="categoryInput" class="w-full p-4 text-2xl text-center bg-black neon-border rounded-lg text-cyan-300 focus:outline-none focus:shadow-lg" placeholder="Type category here... (e.g., Animals, Countries, Foods)">
                </div>
                
                <div class="mb-6">
                    <p class="text-center text-lg mb-4">Choose Timer Duration</p>
                    <div class="flex gap-4 justify-center">
                        <button class="timer-select-btn neon-border rounded-lg px-6 py-3 text-xl font-bold bg-black hover:bg-blue-900 transition" data-time="20">
                            20 SEC
                        </button>
                        <button class="timer-select-btn neon-border-pink rounded-lg px-6 py-3 text-xl font-bold bg-black hover:bg-pink-900 transition selected" data-time="30">
                            30 SEC
                        </button>
                        <button class="timer-select-btn neon-border rounded-lg px-6 py-3 text-xl font-bold bg-black hover:bg-blue-900 transition" data-time="40">
                            40 SEC
                        </button>
                    </div>
                </div>
                
                <h3 class="text-2xl font-bold text-center mb-4 neon-glow">Choose Game Mode</h3>
                <div class="flex gap-4 justify-center">
                    <button id="standardBtn" class="neon-border rounded-lg px-8 py-4 text-xl font-bold bg-black hover:bg-blue-900 transition">
                        STANDARD (A-Z)
                    </button>
                    <button id="randomBtn" class="neon-border rounded-lg px-8 py-4 text-xl font-bold bg-black hover:bg-blue-900 transition">
                        RANDOM ORDER
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Ban Phase Screen -->
        <div id="banPhase" class="hidden space-y-6">
            <div class="neon-border rounded-lg p-6 bg-black bg-opacity-50">
                <!-- Updated to show alternating player bans -->
                <h2 class="text-3xl font-bold text-center mb-4 neon-glow-pink" id="banPhaseTitle">Player 1: Ban a Letter</h2>
                <p class="text-center text-xl mb-6">Click on a letter to ban it or click PASS</p>
                <p class="text-center text-lg mb-4 text-yellow-300" id="banStatus">Total bans: 0/4</p>
                
                <div class="grid grid-cols-7 gap-3 mb-6">
                    <!-- Alphabet letters will be generated here -->
                </div>
                
                <div class="text-center">
                    <button id="passBtn" class="neon-border-pink rounded-lg px-8 py-3 text-xl font-bold bg-black hover:bg-pink-900 transition">
                        PASS
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Category Input Screen -->
        <div id="categoryPhase" class="hidden space-y-6">
            <div class="neon-border rounded-lg p-6 bg-black bg-opacity-50">
                <h2 class="text-3xl font-bold text-center mb-4 neon-glow-pink">Enter Category</h2>
                <p class="text-center text-lg mb-6">What category will you play? (e.g., Animals, Countries, Foods)</p>
                
                <input type="text" id="categoryInput" class="w-full p-4 text-2xl text-center bg-black neon-border rounded-lg text-cyan-300 focus:outline-none focus:shadow-lg mb-6" placeholder="Type category here...">
                
                <h3 class="text-2xl font-bold text-center mb-4 neon-glow">Choose Game Mode</h3>
                <div class="flex gap-4 justify-center mb-6">
                    <button id="standardBtn" class="neon-border rounded-lg px-8 py-4 text-xl font-bold bg-black hover:bg-blue-900 transition">
                        STANDARD (A-Z)
                    </button>
                    <button id="randomBtn" class="neon-border rounded-lg px-8 py-4 text-xl font-bold bg-black hover:bg-blue-900 transition">
                        RANDOM ORDER
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Game Play Screen -->
        <div id="gamePhase" class="hidden space-y-6">
            <div class="grid grid-cols-3 gap-4 mb-6">
                <!-- Player 1 Score -->
                <div class="neon-border rounded-lg p-4 bg-black bg-opacity-50">
                    <h3 class="text-xl font-bold text-center neon-glow">Player 1</h3>
                    <p class="text-4xl font-bold text-center text-cyan-300" id="p1Score">0</p>
                </div>
                
                <!-- Current Letter & Timer -->
                <div class="neon-border-pink rounded-lg p-4 bg-black bg-opacity-50 text-center">
                    <p class="text-lg mb-2">Letter</p>
                    <p class="text-6xl font-bold neon-glow-pink" id="currentLetter">A</p>
                    <p class="text-3xl font-bold mt-2 text-yellow-300" id="timer">20</p>
                </div>
                
                <!-- Player 2 Score -->
                <div class="neon-border rounded-lg p-4 bg-black bg-opacity-50">
                    <h3 class="text-xl font-bold text-center neon-glow">Player 2</h3>
                    <p class="text-4xl font-bold text-center text-pink-300" id="p2Score">0</p>
                </div>
            </div>
            
            <!-- Category Display -->
            <div class="text-center">
                <p class="text-2xl font-bold neon-glow">Category: <span id="categoryDisplay" class="text-pink-300"></span></p>
            </div>
            
            <!-- Current Player Turn -->
            <div class="neon-border rounded-lg p-6 bg-black bg-opacity-50">
                <h2 class="text-3xl font-bold text-center mb-4" id="currentPlayerTitle">Player 1's Turn</h2>
                
                <input type="text" id="answerInput" class="w-full p-4 text-2xl text-center bg-black neon-border rounded-lg text-cyan-300 focus:outline-none focus:shadow-lg mb-4" placeholder="Type your answer...">
                
                <!-- Added WRONG button next to SUBMIT button -->
                <div class="flex gap-4 justify-center mb-4">
                    <button id="submitBtn" class="neon-border-pink rounded-lg px-12 py-4 text-2xl font-bold bg-black hover:bg-pink-900 transition">
                        SUBMIT
                    </button>
                    <button id="wrongBtn" class="neon-border rounded-lg px-12 py-4 text-2xl font-bold bg-black hover:bg-red-900 transition">
                        WRONG
                    </button>
                </div>
                
                <p class="text-center text-lg text-red-400" id="errorMsg"></p>
            </div>
            
            <!-- Used Answers -->
            <div class="neon-border rounded-lg p-4 bg-black bg-opacity-50">
                <h3 class="text-xl font-bold mb-3 neon-glow">Used Answers</h3>
                <div id="usedAnswers" class="flex flex-wrap gap-2 min-h-[40px]">
                    <!-- Used answers will appear here -->
                </div>
            </div>
            
            <!-- Added challenge modal for WRONG button disputes -->
            <div id="challengeModal" class="hidden neon-border-pink rounded-lg p-6 bg-black bg-opacity-95">
                <h3 class="text-2xl font-bold text-center mb-4 neon-glow-pink">CHALLENGE!</h3>
                <p class="text-center text-xl mb-2">Player <span id="challengerPlayer"></span> challenged the answer:</p>
                <p class="text-center text-3xl font-bold text-cyan-300 mb-6" id="challengedAnswer"></p>
                <p class="text-center text-lg mb-6">Is this answer valid?</p>
                
                <div class="flex gap-4 justify-center">
                    <button id="confirmWrongBtn" class="neon-border rounded-lg px-8 py-4 text-xl font-bold bg-black hover:bg-red-900 transition">
                        ANSWER IS WRONG
                    </button>
                    <button id="invalidateChallengeBtn" class="neon-border-pink rounded-lg px-8 py-4 text-xl font-bold bg-black hover:bg-green-900 transition">
                        ANSWER IS VALID
                    </button>
                </div>
            </div>
            
            <!-- End Game Button -->
            <div class="text-center">
                <button id="endGameBtn" class="neon-border rounded-lg px-8 py-3 text-xl font-bold bg-black hover:bg-red-900 transition">
                    END GAME
                </button>
            </div>
        </div>
        
        <!-- Game Over Screen -->
        <div id="gameOverPhase" class="hidden space-y-6">
            <div class="neon-border-pink rounded-lg p-6 bg-black bg-opacity-50">
                <h2 class="text-5xl font-bold text-center mb-6 neon-glow-pink">GAME OVER</h2>
                
                <div class="grid grid-cols-2 gap-6 mb-6">
                    <div class="neon-border rounded-lg p-6 bg-black">
                        <h3 class="text-2xl font-bold text-center neon-glow mb-2">Player 1</h3>
                        <p class="text-5xl font-bold text-center text-cyan-300" id="finalP1Score">0</p>
                    </div>
                    <div class="neon-border rounded-lg p-6 bg-black">
                        <h3 class="text-2xl font-bold text-center neon-glow">Player 2</h3>
                        <p class="text-5xl font-bold text-center text-pink-300" id="finalP2Score">0</p>
                    </div>
                </div>
                
                <h3 class="text-3xl font-bold text-center mb-4 neon-glow" id="winnerText">Winner: Player 1!</h3>
                
                <div class="neon-border rounded-lg p-4 bg-black mb-6">
                    <!-- Updated results to show words entered by each player per round -->
                    <h4 class="text-xl font-bold mb-4 text-center neon-glow-pink">Round by Round Results</h4>
                    <div id="detailedResults" class="space-y-2 max-h-96 overflow-y-auto">
                        <!-- Detailed results will appear here -->
                    </div>
                </div>
                
                <div class="text-center">
                    <button id="playAgainBtn" class="neon-border-pink rounded-lg px-12 py-4 text-2xl font-bold bg-black hover:bg-pink-900 transition">
                        PLAY AGAIN
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const gameState = {
            phase: 'setup',
            currentPlayer: 1,
            totalBans: 0,
            bannedLetters: new Set(),
            category: '',
            gameMode: '',
            timerDuration: 30,
            letters: [],
            currentLetterIndex: 0,
            player1Score: 0,
            player2Score: 0,
            timer: 30,
            timerInterval: null,
            usedAnswers: new Set(),
            roundResults: [],
            lastAnswerPlayer: null,
            currentRoundAnswers: [],
            challengeInProgress: false,
            lastAnswer: '',
            answeringPlayer: null,
            defendant: null,
            accuser: null,
            challengedAnswer: '',
            lastSubmittedAnswer: null,
            lastSubmittedPlayer: null
        };

        const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');

        document.querySelectorAll('.timer-select-btn').forEach(btn => {
            btn.onclick = function() {
                document.querySelectorAll('.timer-select-btn').forEach(b => {
                    b.classList.remove('selected', 'neon-border-pink');
                    b.classList.add('neon-border');
                });
                this.classList.add('selected', 'neon-border-pink');
                this.classList.remove('neon-border');
                gameState.timerDuration = parseInt(this.dataset.time);
            };
        });

        document.getElementById('standardBtn').onclick = function() {
            startBanPhase('standard');
        };

        document.getElementById('randomBtn').onclick = function() {
            startBanPhase('random');
        };

        function startBanPhase(mode) {
            const category = document.getElementById('categoryInput').value.trim();
            if (!category) {
                document.getElementById('categoryInput').focus();
                document.getElementById('categoryInput').classList.add('pulse-animation');
                setTimeout(() => {
                    document.getElementById('categoryInput').classList.remove('pulse-animation');
                }, 1000);
                return;
            }
            
            gameState.category = category;
            gameState.gameMode = mode;
            
            document.getElementById('setupPhase').classList.add('hidden');
            document.getElementById('banPhase').classList.remove('hidden');
            
            initBanPhase();
        }

        function initBanPhase() {
            const container = document.querySelector('#banPhase .grid');
            container.innerHTML = '';
            
            alphabet.forEach(letter => {
                const btn = document.createElement('button');
                btn.textContent = letter;
                btn.className = 'letter-btn rounded-lg py-3 text-xl font-bold';
                btn.dataset.letter = letter;
                btn.onclick = () => banLetter(letter, btn);
                container.appendChild(btn);
            });
            
            updateBanDisplay();
        }

        function banLetter(letter, btn) {
            if (gameState.bannedLetters.has(letter)) return;
            if (gameState.totalBans >= 4) return;
            
            gameState.bannedLetters.add(letter);
            btn.classList.add('banned');
            gameState.totalBans++;
            
            if (gameState.totalBans >= 4) {
                setTimeout(() => startGame(), 500);
            } else {
                gameState.currentPlayer = gameState.currentPlayer === 1 ? 2 : 1;
                updateBanDisplay();
            }
        }

        function updateBanDisplay() {
            document.getElementById('banPhaseTitle').textContent = `Player ${gameState.currentPlayer}: Ban a Letter`;
            document.getElementById('banStatus').textContent = `Total bans: ${gameState.totalBans}/4`;
        }

        document.getElementById('passBtn').onclick = function() {
            gameState.totalBans++;
            
            if (gameState.totalBans >= 4) {
                startGame();
            } else {
                gameState.currentPlayer = gameState.currentPlayer === 1 ? 2 : 1;
                updateBanDisplay();
            }
        };

        function startGame() {
            gameState.letters = alphabet.filter(l => !gameState.bannedLetters.has(l));
            
            if (gameState.gameMode === 'random') {
                gameState.letters = shuffle(gameState.letters);
            }
            
            gameState.currentLetterIndex = 0;
            gameState.currentPlayer = 1;
            
            showGamePhase();
        }

        function shuffle(array) {
            const arr = [...array];
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }

        function showGamePhase() {
            document.getElementById('banPhase').classList.add('hidden');
            document.getElementById('gamePhase').classList.remove('hidden');
            document.getElementById('categoryDisplay').textContent = gameState.category;
            
            updateGameDisplay();
            startTimer();
        }

        function updateGameDisplay() {
            document.getElementById('currentLetter').textContent = gameState.letters[gameState.currentLetterIndex];
            document.getElementById('currentPlayerTitle').textContent = `Player ${gameState.currentPlayer}'s Turn`;
            document.getElementById('p1Score').textContent = gameState.player1Score;
            document.getElementById('p2Score').textContent = gameState.player2Score;
            document.getElementById('errorMsg').textContent = '';
            document.getElementById('answerInput').value = '';
            document.getElementById('answerInput').focus();
            
            const usedContainer = document.getElementById('usedAnswers');
            usedContainer.innerHTML = '';
            gameState.usedAnswers.forEach(answer => {
                const span = document.createElement('span');
                span.textContent = answer;
                span.className = 'px-3 py-1 bg-pink-900 rounded-lg text-sm';
                usedContainer.appendChild(span);
            });
        }

        function startTimer() {
            gameState.timer = gameState.timerDuration;
            updateTimerDisplay();
            
            clearInterval(gameState.timerInterval);
            gameState.timerInterval = setInterval(() => {
                gameState.timer--;
                updateTimerDisplay();
                
                if (gameState.timer <= 5) {
                    document.getElementById('timer').classList.add('timer-warning');
                }
                
                if (gameState.timer <= 0) {
                    timeOut();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const timerEl = document.getElementById('timer');
            timerEl.textContent = gameState.timer;
            
            if (gameState.timer > 5) {
                timerEl.classList.remove('timer-warning');
            }
        }

        function timeOut() {
            clearInterval(gameState.timerInterval);
            
            const oppositePlayer = gameState.currentPlayer === 1 ? 2 : 1;
            
            if (oppositePlayer === 1) {
                gameState.player1Score++;
            } else {
                gameState.player2Score++;
            }
            
            gameState.roundResults.push({
                letter: gameState.letters[gameState.currentLetterIndex],
                winner: oppositePlayer,
                answers: [...gameState.currentRoundAnswers],
                timedOut: true,
                timedOutPlayer: gameState.currentPlayer
            });
            
            nextLetter();
        }

        function submitAnswer() {
            const answer = document.getElementById('answerInput').value.trim().toUpperCase();
            const currentLetter = gameState.letters[gameState.currentLetterIndex];
            const errorMsg = document.getElementById('errorMsg');
            
            if (!answer) {
                errorMsg.textContent = 'Please enter an answer!';
                return;
            }
            
            if (!answer.startsWith(currentLetter)) {
                errorMsg.textContent = `Answer must start with ${currentLetter}!`;
                return;
            }
            
            if (gameState.usedAnswers.has(answer)) {
                errorMsg.textContent = 'This answer was already used!';
                return;
            }
            
            gameState.lastSubmittedAnswer = answer;
            gameState.lastSubmittedPlayer = gameState.currentPlayer;
            
            gameState.usedAnswers.add(answer);
            gameState.lastAnswerPlayer = gameState.currentPlayer;
            gameState.lastAnswer = answer;
            gameState.answeringPlayer = gameState.currentPlayer;
            gameState.currentRoundAnswers.push({
                player: gameState.currentPlayer,
                answer: answer
            });
            
            gameState.currentPlayer = gameState.currentPlayer === 1 ? 2 : 1;
            
            updateGameDisplay();
            startTimer();
        }

        document.getElementById('submitBtn').onclick = submitAnswer;
        
        document.getElementById('wrongBtn').onclick = function() {
            console.log('[v0] WRONG button clicked');
            console.log('[v0] Last submitted answer:', gameState.lastSubmittedAnswer);
            console.log('[v0] Challenge in progress:', gameState.challengeInProgress);
            
            // Only allow challenges when there's a submitted answer and no challenge in progress
            if (!gameState.lastSubmittedAnswer || gameState.challengeInProgress) {
                console.log('[v0] Cannot challenge - no answer or challenge already in progress');
                return;
            }
            
            // Pause the game
            clearInterval(gameState.timerInterval);
            gameState.challengeInProgress = true;
            
            // The player who submitted the answer is the defendant
            const defendant = gameState.lastSubmittedPlayer;
            // Other player is the accuser (current player who is about to answer)
            const accuser = gameState.currentPlayer;
            
            console.log('[v0] Defendant:', defendant, 'Accuser:', accuser);
            
            document.getElementById('challengerPlayer').textContent = accuser;
            document.getElementById('challengedAnswer').textContent = gameState.lastSubmittedAnswer;
            document.getElementById('challengeModal').classList.remove('hidden');
            document.getElementById('answerInput').disabled = true;
            document.getElementById('submitBtn').disabled = true;
            document.getElementById('wrongBtn').disabled = true;
            
            // Store for later use
            gameState.defendant = defendant;
            gameState.accuser = accuser;
            gameState.challengedAnswer = gameState.lastSubmittedAnswer;
        };

        document.getElementById('confirmWrongBtn').onclick = function() {
            console.log('[v0] Confirm wrong clicked');
            const defendant = gameState.defendant;
            const accuser = gameState.accuser;
            
            // Defendant loses a point
            if (defendant === 1) {
                gameState.player1Score = Math.max(0, gameState.player1Score - 1);
            } else {
                gameState.player2Score = Math.max(0, gameState.player2Score - 1);
            }
            
            // Remove the challenged answer from used answers
            gameState.usedAnswers.delete(gameState.challengedAnswer);
            
            // Remove the answer from current round answers
            gameState.currentRoundAnswers = gameState.currentRoundAnswers.filter(
                a => a.answer !== gameState.challengedAnswer
            );
            
            gameState.roundResults.push({
                letter: gameState.letters[gameState.currentLetterIndex],
                winner: accuser,
                answers: [...gameState.currentRoundAnswers],
                note: `Challenge by P${accuser} successful - "${gameState.challengedAnswer}" was wrong. P${defendant} lost a point.`
            });
            
            gameState.lastSubmittedAnswer = null;
            gameState.lastSubmittedPlayer = null;
            
            // Close modal
            document.getElementById('challengeModal').classList.add('hidden');
            document.getElementById('answerInput').value = '';
            document.getElementById('answerInput').disabled = false;
            document.getElementById('submitBtn').disabled = false;
            document.getElementById('wrongBtn').disabled = false;
            gameState.challengeInProgress = false;
            
            // Next round starts with defendant as current player
            gameState.currentPlayer = defendant;
            nextLetter();
        };

        document.getElementById('invalidateChallengeBtn').onclick = function() {
            console.log('[v0] Invalidate challenge clicked');
            const defendant = gameState.defendant;
            const accuser = gameState.accuser;
            
            // Accuser loses a point
            if (accuser === 1) {
                gameState.player1Score = Math.max(0, gameState.player1Score - 1);
            } else {
                gameState.player2Score = Math.max(0, gameState.player2Score - 1);
            }
            
            // Answer is already in usedAnswers and currentRoundAnswers, keep it there
            
            gameState.roundResults.push({
                letter: gameState.letters[gameState.currentLetterIndex],
                winner: defendant,
                answers: [...gameState.currentRoundAnswers],
                note: `Failed challenge by P${accuser} - "${gameState.challengedAnswer}" was valid. P${accuser} lost a point.`
            });
            
            gameState.lastSubmittedAnswer = null;
            gameState.lastSubmittedPlayer = null;
            
            // Close modal
            document.getElementById('challengeModal').classList.add('hidden');
            document.getElementById('answerInput').value = '';
            document.getElementById('answerInput').disabled = false;
            document.getElementById('submitBtn').disabled = false;
            document.getElementById('wrongBtn').disabled = false;
            gameState.challengeInProgress = false;
            
            // Next round starts with accuser as current player
            gameState.currentPlayer = accuser;
            nextLetter();
        };

        function nextLetter() {
            gameState.currentLetterIndex++;
            gameState.lastAnswerPlayer = null;
            gameState.currentRoundAnswers = [];
            
            if (gameState.currentLetterIndex >= gameState.letters.length) {
                endGame();
            } else {
                updateGameDisplay();
                startTimer();
            }
        }

        document.getElementById('endGameBtn').onclick = function() {
            clearInterval(gameState.timerInterval);
            
            if (gameState.currentRoundAnswers.length > 0) {
                if (gameState.lastAnswerPlayer) {
                    if (gameState.lastAnswerPlayer === 1) {
                        gameState.player1Score++;
                    } else {
                        gameState.player2Score++;
                    }
                }
                
                gameState.roundResults.push({
                    letter: gameState.letters[gameState.currentLetterIndex],
                    winner: gameState.lastAnswerPlayer,
                    answers: [...gameState.currentRoundAnswers]
                });
            }
            
            endGame();
        };

        function endGame() {
            clearInterval(gameState.timerInterval);
            
            document.getElementById('gamePhase').classList.add('hidden');
            document.getElementById('gameOverPhase').classList.remove('hidden');
            
            document.getElementById('finalP1Score').textContent = gameState.player1Score;
            document.getElementById('finalP2Score').textContent = gameState.player2Score;
            
            if (gameState.player1Score > gameState.player2Score) {
                document.getElementById('winnerText').textContent = 'Winner: Player 1!';
            } else if (gameState.player2Score > gameState.player1Score) {
                document.getElementById('winnerText').textContent = 'Winner: Player 2!';
            } else {
                document.getElementById('winnerText').textContent = "It's a Tie!";
            }
            
            displayDetailedResults();
        }

        function displayDetailedResults() {
            const container = document.getElementById('detailedResults');
            container.innerHTML = '';
            
            gameState.roundResults.forEach(round => {
                const roundDiv = document.createElement('div');
                roundDiv.className = 'p-3 bg-black bg-opacity-50 neon-border rounded-lg';
                
                let roundHTML = `<div class="font-bold text-lg mb-2">Letter: ${round.letter}</div>`;
                
                if (round.answers.length === 0) {
                    roundHTML += `<div class="text-gray-400">No answers given</div>`;
                } else {
                    roundHTML += `<div class="space-y-1 mb-2">`;
                    round.answers.forEach(answerObj => {
                        const playerColor = answerObj.player === 1 ? 'text-cyan-300' : 'text-pink-300';
                        roundHTML += `<div class="${playerColor}">Player ${answerObj.player}: ${answerObj.answer}</div>`;
                    });
                    roundHTML += `</div>`;
                    
                    if (round.winner) {
                        const winnerColor = round.winner === 1 ? 'text-cyan-300' : 'text-pink-300';
                        roundHTML += `<div class="${winnerColor} font-bold">Point awarded to Player ${round.winner}</div>`;
                    }
                }
                
                if (round.note) {
                    roundHTML += `<div class="text-gray-400 mt-2">${round.note}</div>`;
                }
                
                if (round.timedOut) {
                    roundHTML += `<div class="text-gray-400 mt-2">Player ${round.timedOutPlayer} timed out</div>`;
                }
                
                roundDiv.innerHTML = roundHTML;
                container.appendChild(roundDiv);
            });
        }

        document.getElementById('playAgainBtn').onclick = function() {
            location.reload();
        };
    </script>
</body>
</html>
