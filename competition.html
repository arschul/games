<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESL Student Competition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Source+Sans+Pro:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --background: #0a0a0a;
            --foreground: #f0f0f0;
            --card: #1a1a1a;
            --card-foreground: #f0f0f0;
            --primary: #3b82f6;
            --primary-foreground: #ffffff;
            --secondary: #00f5ff;
            --secondary-foreground: #0a0a0a;
            --accent: #ff00e1;
            --accent-foreground: #0a0a0a;
            --destructive: #ff4d4d;
            --border: #374151;
            --input: #1a1a1a;
            --ring: #3b82f6;
        }
        
        body {
            background: var(--background);
            color: var(--foreground);
            font-family: 'Source Sans Pro', sans-serif;
        }
        
        .heading-font {
            font-family: 'Playfair Display', serif;
        }
        
        .neon-glow {
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
        }
        
        .neon-text {
            text-shadow: 0 0 10px currentColor;
        }
        
        .cyber-border {
            border: 2px solid var(--primary);
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(0, 245, 255, 0.05));
        }
        
        .pulse-glow {
            animation: pulse-glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes pulse-glow {
            from { box-shadow: 0 0 20px rgba(59, 130, 246, 0.3); }
            to { box-shadow: 0 0 30px rgba(59, 130, 246, 0.6); }
        }
        
        .match-card {
            background: linear-gradient(135deg, #1a1a1a, #2a2a2a);
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }
        
        .match-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.2);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), #2563eb);
            border: 1px solid var(--primary);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.6);
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary), #00d4ff);
            color: var(--secondary-foreground);
            border: 1px solid var(--secondary);
        }
        
        .btn-accent {
            background: linear-gradient(135deg, var(--accent), #e600cc);
            color: var(--accent-foreground);
            border: 1px solid var(--accent);
        }
        
        .leaderboard-item {
            background: linear-gradient(135deg, rgba(26, 26, 26, 0.8), rgba(42, 42, 42, 0.6));
            border-left: 4px solid var(--primary);
            transition: all 0.3s ease;
        }
        
        .leaderboard-item:hover {
            border-left-color: var(--secondary);
            box-shadow: 0 5px 15px rgba(0, 245, 255, 0.2);
        }
        
        .winner-glow {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 0, 225, 0.05));
            border: 2px solid #ffd700;
            box-shadow: 0 0 25px rgba(255, 215, 0, 0.3);
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Added cyberpunk background pattern and enhanced styling -->
    <div class="fixed inset-0 bg-gradient-to-br from-slate-900 via-gray-900 to-slate-800 opacity-50"></div>
    <div class="relative z-10 container mx-auto px-4 py-8 max-w-6xl">
        <!-- Updated header with cyberpunk styling and neon effects -->
        <h1 class="text-5xl font-bold text-center mb-12 heading-font neon-text text-blue-400 pulse-glow">
            ESL CYBER TOURNAMENT
        </h1>
        
        <!-- Step 1: Number of Students -->
        <div id="step1" class="match-card rounded-lg p-6 mb-6">
            <h2 class="text-2xl font-semibold mb-4 heading-font text-cyan-400">Initialize Tournament</h2>
            <div class="space-y-4">
                <div class="flex items-center gap-4">
                    <label for="studentCount" class="text-gray-300">Number of competitors:</label>
                    <input type="number" id="studentCount" min="2" max="20" value="4" 
                           class="bg-gray-800 border border-blue-500 rounded px-3 py-2 w-20 text-center text-white focus:ring-2 focus:ring-blue-400 focus:border-transparent">
                </div>
                <!-- Added tournament format selection -->
                <div class="flex items-center gap-4">
                    <label for="tournamentFormat" class="text-gray-300">Tournament format:</label>
                    <select id="tournamentFormat" 
                            class="bg-gray-800 border border-blue-500 rounded px-3 py-2 text-white focus:ring-2 focus:ring-blue-400 focus:border-transparent">
                        <option value="single">Single Round-Robin (each pair plays once)</option>
                        <option value="double">Double Round-Robin (each pair plays twice)</option>
                    </select>
                </div>
                <button onclick="setupStudents()" 
                        class="btn-primary text-white px-6 py-3 rounded-lg font-medium">
                    Initialize System
                </button>
            </div>
        </div>

        <!-- Step 2: Student Names -->
        <div id="step2" class="match-card rounded-lg p-6 mb-6 hidden">
            <h2 class="text-2xl font-semibold mb-4 heading-font text-cyan-400">Register Competitors</h2>
            <div id="studentInputs" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6"></div>
            <button onclick="generateMatches()" 
                    class="btn-secondary px-6 py-3 rounded-lg font-medium">
                Launch Tournament
            </button>
        </div>

        <!-- Tournament Section -->
        <div id="tournamentSection" class="hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Current Match -->
                <div class="match-card rounded-lg p-6">
                    <h2 class="text-2xl font-semibold mb-4 heading-font text-cyan-400">Active Battle</h2>
                    <div id="currentMatch" class="text-center">
                        <p class="text-gray-400">No battles scheduled</p>
                    </div>
                </div>

                <!-- Leaderboard -->
                <div class="match-card rounded-lg p-6">
                    <h2 class="text-2xl font-semibold mb-4 heading-font text-cyan-400">Rankings</h2>
                    <div id="leaderboard"></div>
                </div>
            </div>

            <!-- Match History -->
            <div class="match-card rounded-lg p-6 mt-6">
                <h2 class="text-2xl font-semibold mb-4 heading-font text-cyan-400">Battle Log</h2>
                <div id="matchHistory" class="space-y-2"></div>
            </div>
        </div>
    </div>

    <!-- Added sound effects and enhanced tournament scheduling logic -->
    <script>
        let students = [];
        let matches = [];
        let currentMatchIndex = 0;
        let results = [];
        let playerLastMatch = {}; // Track when each player last played
        let tournamentFormat = 'single';

        function playSound(type) {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            let frequency;
            
            switch(type) {
                case 'win': frequency = 800; break;
                case 'draw': frequency = 600; break;
                case 'loss': frequency = 400; break;
                case 'setup': frequency = 1000; break;
                default: frequency = 500;
            }
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.3);
        }

        function setupStudents() {
            const count = parseInt(document.getElementById('studentCount').value);
            if (count < 2) {
                alert('Please enter at least 2 competitors');
                return;
            }

            playSound('setup');
            students = [];
            const inputsContainer = document.getElementById('studentInputs');
            inputsContainer.innerHTML = '';

            for (let i = 0; i < count; i++) {
                const div = document.createElement('div');
                div.innerHTML = `
                    <label class="block text-gray-300 mb-2 font-semibold">Competitor ${i + 1}:</label>
                    <input type="text" id="student${i}" value="Player ${i + 1}" 
                           class="w-full bg-gray-800 border border-blue-500 rounded px-3 py-2 text-white focus:ring-2 focus:ring-cyan-400 focus:border-transparent">
                `;
                inputsContainer.appendChild(div);
            }

            document.getElementById('step2').classList.remove('hidden');
        }

        function generateOptimalSchedule(playerList) {
            const schedule = [];
            const totalPlayers = playerList.length;
            const playerLastMatch = {};
            
            // Initialize last match tracking
            playerList.forEach(player => {
                playerLastMatch[player] = -1;
            });
            
            const allMatches = [];
            const rounds = tournamentFormat === 'double' ? 2 : 1;
            
            for (let round = 0; round < rounds; round++) {
                for (let i = 0; i < totalPlayers; i++) {
                    for (let j = i + 1; j < totalPlayers; j++) {
                        allMatches.push({
                            player1: playerList[i],
                            player2: playerList[j],
                            result: null,
                            round: round + 1
                        });
                    }
                }
            }
            
            // Schedule matches to maximize rest time
            const scheduledMatches = [];
            const remainingMatches = [...allMatches];
            
            while (remainingMatches.length > 0) {
                let bestMatch = null;
                let bestRestScore = -1;
                let bestIndex = -1;
                
                // Find the match that gives the longest rest to both players
                for (let i = 0; i < remainingMatches.length; i++) {
                    const match = remainingMatches[i];
                    const player1LastMatch = playerLastMatch[match.player1];
                    const player2LastMatch = playerLastMatch[match.player2];
                    
                    // Calculate rest score (higher is better)
                    const restScore = (scheduledMatches.length - player1LastMatch) + 
                                    (scheduledMatches.length - player2LastMatch);
                    
                    if (restScore > bestRestScore) {
                        bestRestScore = restScore;
                        bestMatch = match;
                        bestIndex = i;
                    }
                }
                
                // Schedule the best match
                if (bestMatch) {
                    scheduledMatches.push(bestMatch);
                    playerLastMatch[bestMatch.player1] = scheduledMatches.length - 1;
                    playerLastMatch[bestMatch.player2] = scheduledMatches.length - 1;
                    remainingMatches.splice(bestIndex, 1);
                }
            }
            
            return scheduledMatches;
        }

        function generateMatches() {
            tournamentFormat = document.getElementById('tournamentFormat').value;
            
            // Collect student names
            students = [];
            const inputs = document.querySelectorAll('#studentInputs input');
            inputs.forEach(input => {
                if (input.value.trim()) {
                    students.push(input.value.trim());
                }
            });

            if (students.length < 2) {
                alert('Please enter at least 2 competitor names');
                return;
            }

            playSound('setup');

            matches = generateOptimalSchedule(students);
            currentMatchIndex = 0;
            results = [];
            
            // Initialize student scores
            students.forEach(student => {
                results.push({
                    name: student,
                    points: 0,
                    wins: 0,
                    draws: 0,
                    losses: 0
                });
            });

            document.getElementById('tournamentSection').classList.remove('hidden');
            displayCurrentMatch();
            updateLeaderboard();
        }

        function displayCurrentMatch() {
            const matchContainer = document.getElementById('currentMatch');
            
            if (currentMatchIndex >= matches.length) {
                matchContainer.innerHTML = `
                    <div class="text-center cyber-border rounded-lg p-6">
                        <h3 class="text-2xl font-bold text-yellow-400 mb-4 neon-text heading-font">TOURNAMENT COMPLETE!</h3>
                        <p class="text-gray-300">All battles have been fought.</p>
                        <div class="mt-4 text-cyan-400 text-lg">🏆 Champion Crowned! 🏆</div>
                    </div>
                `;
                return;
            }

            const match = matches[currentMatchIndex];
            const roundText = match.round ? ` (Round ${match.round})` : '';
            matchContainer.innerHTML = `
                <div class="cyber-border rounded-lg p-6">
                    <h3 class="text-xl font-semibold mb-6 text-center heading-font text-yellow-400">
                        BATTLE ${currentMatchIndex + 1} OF ${matches.length}${roundText}
                    </h3>
                    <div class="flex items-center justify-center gap-6 mb-8">
                        <div class="text-center">
                            <div class="bg-gradient-to-r from-blue-600 to-blue-500 rounded-lg p-4 mb-2 neon-glow">
                                <span class="font-bold text-white text-lg">${match.player1}</span>
                            </div>
                        </div>
                        <div class="text-4xl font-bold text-cyan-400 neon-text animate-pulse">VS</div>
                        <div class="text-center">
                            <div class="bg-gradient-to-r from-red-600 to-red-500 rounded-lg p-4 mb-2 neon-glow">
                                <span class="font-bold text-white text-lg">${match.player2}</span>
                            </div>
                        </div>
                    </div>
                    <div class="flex justify-center gap-4">
                        <button onclick="recordResult('${match.player1}', '${match.player2}', 'win')" 
                                class="btn-primary text-white px-6 py-3 rounded-lg font-medium">
                            ${match.player1} WINS
                        </button>
                        <button onclick="recordResult('${match.player1}', '${match.player2}', 'draw')" 
                                class="bg-gradient-to-r from-yellow-500 to-yellow-400 hover:from-yellow-400 hover:to-yellow-300 text-black px-6 py-3 rounded-lg font-medium transition-all">
                            DRAW
                        </button>
                        <button onclick="recordResult('${match.player1}', '${match.player2}', 'loss')" 
                                class="btn-accent text-white px-6 py-3 rounded-lg font-medium">
                            ${match.player2} WINS
                        </button>
                    </div>
                </div>
            `;
        }

        function recordResult(player1, player2, result) {
            const match = matches[currentMatchIndex];
            match.result = result;

            // Play appropriate sound
            playSound(result);

            // Update scores
            const player1Data = results.find(r => r.name === player1);
            const player2Data = results.find(r => r.name === player2);

            if (result === 'win') {
                player1Data.points += 3;
                player1Data.wins++;
                player2Data.losses++;
            } else if (result === 'loss') {
                player2Data.points += 3;
                player2Data.wins++;
                player1Data.losses++;
            } else { // draw
                player1Data.points += 1;
                player2Data.points += 1;
                player1Data.draws++;
                player2Data.draws++;
            }

            // Add to match history
            addToMatchHistory(player1, player2, result);

            currentMatchIndex++;
            displayCurrentMatch();
            updateLeaderboard();
        }

        function addToMatchHistory(player1, player2, result) {
            const historyContainer = document.getElementById('matchHistory');
            const matchDiv = document.createElement('div');
            matchDiv.className = 'leaderboard-item rounded p-4 flex justify-between items-center';
            
            let resultText = '';
            let resultClass = '';
            
            if (result === 'win') {
                resultText = `${player1} defeated ${player2}`;
                resultClass = 'text-blue-400';
            } else if (result === 'loss') {
                resultText = `${player2} defeated ${player1}`;
                resultClass = 'text-pink-400';
            } else {
                resultText = `${player1} drew with ${player2}`;
                resultClass = 'text-yellow-400';
            }
            
            const match = matches[currentMatchIndex];
            const roundText = match && match.round ? ` (R${match.round})` : '';
            
            matchDiv.innerHTML = `
                <span class="${resultClass} font-semibold">${resultText}</span>
                <span class="text-gray-400 text-sm">Battle ${currentMatchIndex + 1}${roundText}</span>
            `;
            
            historyContainer.appendChild(matchDiv);
        }

        function updateLeaderboard() {
            // Sort by points (descending), then by name (ascending)
            const sortedResults = [...results].sort((a, b) => {
                if (b.points !== a.points) {
                    return b.points - a.points;
                }
                return a.name.localeCompare(b.name);
            });

            const rankedResults = [];
            let currentRank = 1;
            
            for (let i = 0; i < sortedResults.length; i++) {
                const student = sortedResults[i];
                
                // If this student has different points than the previous, update rank
                if (i > 0 && sortedResults[i-1].points !== student.points) {
                    currentRank = i + 1;
                }
                
                rankedResults.push({
                    ...student,
                    rank: currentRank
                });
            }

            const leaderboardContainer = document.getElementById('leaderboard');
            leaderboardContainer.innerHTML = `
                <div class="space-y-3">
                    ${rankedResults.map((student, index) => `
                        <div class="leaderboard-item ${student.rank === 1 ? 'winner-glow' : ''} rounded-lg p-4 flex justify-between items-center">
                            <div class="flex items-center gap-4">
                                <span class="font-bold text-2xl ${student.rank === 1 ? 'text-yellow-400' : 'text-cyan-400'} neon-text">
                                    #${student.rank}
                                </span>
                                <span class="font-semibold text-lg ${student.rank === 1 ? 'text-yellow-200' : 'text-white'}">${student.name}</span>
                                ${student.rank === 1 ? '<span class="text-yellow-400">👑</span>' : ''}
                            </div>
                            <div class="text-right">
                                <div class="font-bold text-xl ${student.rank === 1 ? 'text-yellow-400' : 'text-cyan-400'}">${student.points} PTS</div>
                                <div class="text-sm text-gray-400">
                                    ${student.wins}W ${student.draws}D ${student.losses}L
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }
    </script>
</body>
</html>
