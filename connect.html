<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Word Battle Arena</title>
  <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;600;700&family=Open+Sans:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --background: #f8fafc;
      --foreground: #1f2937;
      --card: #ffffff;
      --card-foreground: #374151;
      --primary: #374151;
      --primary-foreground: #ffffff;
      --secondary: #6366f1;
      --secondary-foreground: #ffffff;
      --muted: #f8fafc;
      --muted-foreground: #1f2937;
      --accent: #6366f1;
      --accent-foreground: #ffffff;
      --border: #d1d5db;
      --input: #ffffff;
      --ring: rgba(99, 102, 241, 0.5);
      --radius: 0.5rem;
      --player1-color: #dc2626;
      --player2-color: #2563eb;
    }

    /* Added dark mode CSS variables */
    [data-theme="dark"] {
      --background: #0f172a;
      --foreground: #f1f5f9;
      --card: #1e293b;
      --card-foreground: #e2e8f0;
      --primary: #f1f5f9;
      --primary-foreground: #0f172a;
      --secondary: #6366f1;
      --secondary-foreground: #ffffff;
      --muted: #334155;
      --muted-foreground: #cbd5e1;
      --accent: #6366f1;
      --accent-foreground: #ffffff;
      --border: #475569;
      --input: #1e293b;
      --ring: rgba(99, 102, 241, 0.5);
      --player1-color: #ef4444;
      --player2-color: #3b82f6;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 20px;
      font-family: 'Open Sans', sans-serif;
      background: linear-gradient(135deg, var(--background) 0%, #e2e8f0 100%);
      color: var(--foreground);
      min-height: 100vh;
      transition: all 0.3s ease;
    }

    .game-header {
      text-align: center;
      margin-bottom: 30px;
      /* Added relative positioning for theme toggle */
      position: relative;
    }

    .game-title {
      font-family: 'Work Sans', sans-serif;
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--primary);
      margin: 0 0 10px 0;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
    }

    /* Added styling for game control buttons */
    .game-btn {
      padding: 10px 20px;
      border: none;
      border-radius: var(--radius);
      background: var(--primary);
      color: var(--primary-foreground);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      font-family: 'Work Sans', sans-serif;
    }

    .game-btn:hover {
      background: var(--accent);
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }

    .game-btn:disabled {
      background: var(--muted-foreground);
      cursor: not-allowed;
      transform: none;
    }

    .pause-btn {
      width: 40px;
      height: 40px;
      border: none;
      border-radius: 50%;
      background: var(--primary);
      color: var(--primary-foreground);
      font-size: 16px;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .pause-btn:hover {
      background: var(--accent);
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }

    /* Added rules section styling */
    .rules-section {
      max-width: 600px;
      margin: 0 auto 30px auto;
      background: var(--card);
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }

    .rules-title {
      font-family: 'Work Sans', sans-serif;
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--primary);
      margin: 0 0 15px 0;
      text-align: center;
    }

    .rules-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 10px;
    }

    .rules-list li {
      padding: 8px 12px;
      background: var(--muted);
      border-radius: calc(var(--radius) - 2px);
      font-size: 14px;
      color: var(--card-foreground);
      border-left: 3px solid var(--accent);
    }

    .game-container {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 40px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .player-section {
      width: 280px;
      background: var(--card);
      border-radius: var(--radius);
      padding: 25px;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }

    .player-section.active {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1);
    }

    .player-section.player1.active {
      border-left: 4px solid var(--player1-color);
    }

    .player-section.player2.active {
      border-left: 4px solid var(--player2-color);
    }

    .player-header {
      font-family: 'Work Sans', sans-serif;
      font-size: 1.3rem;
      font-weight: 600;
      margin-bottom: 15px;
      text-align: center;
    }

    .player1 .player-header {
      color: var(--player1-color);
    }

    .player2 .player-header {
      color: var(--player2-color);
    }

    .word-input {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid var(--border);
      border-radius: var(--radius);
      font-size: 16px;
      font-family: 'Open Sans', sans-serif;
      background: var(--input);
      color: var(--card-foreground);
      transition: all 0.2s ease;
      margin-bottom: 15px;
    }

    .word-input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--ring);
    }

    .word-list {
      min-height: 120px;
      max-height: 200px;
      overflow-y: auto;
      padding: 15px;
      background: var(--muted);
      border-radius: var(--radius);
      font-size: 14px;
      line-height: 1.6;
      word-wrap: break-word;
      margin-bottom: 15px;
      border: 1px solid var(--border);
    }

    .score-display {
      text-align: center;
      font-family: 'Work Sans', sans-serif;
      font-size: 1.2rem;
      font-weight: 600;
      padding: 10px;
      background: var(--muted);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      margin-bottom: 15px;
    }

    /* Added end turn button styling */
    .end-turn-btn {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: var(--radius);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: 'Work Sans', sans-serif;
    }

    .player1 .end-turn-btn {
      background: var(--player1-color);
      color: white;
    }

    .player2 .end-turn-btn {
      background: var(--player2-color);
      color: white;
    }

    .end-turn-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }

    .grid-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      background: var(--card);
      border-radius: var(--radius);
      padding: 30px;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }

    .grid-header {
      font-family: 'Work Sans', sans-serif;
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--primary);
      margin-bottom: 20px;
    }

    .coordinates {
      display: flex;
      justify-content: center;
      margin-bottom: 8px;
      font-family: 'Work Sans', sans-serif;
      font-weight: 500;
      color: var(--muted-foreground);
    }

    .grid-with-labels {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .row-labels {
      display: flex;
      flex-direction: column;
      gap: 2px;
      font-family: 'Work Sans', sans-serif;
      font-weight: 500;
      color: var(--muted-foreground);
    }

    .row-label {
      height: 52px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      width: 52px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(6, 52px);
      grid-template-rows: repeat(6, 52px);
      gap: 2px;
      padding: 8px;
      background: var(--border);
      border-radius: var(--radius);
    }

    .grid-cell {
      background: var(--card);
      border-radius: calc(var(--radius) - 2px);
      display: flex;
      justify-content: center;
      align-items: center;
      transition: all 0.2s ease;
    }

    .grid-cell:hover {
      background: var(--muted);
    }

    .grid-input {
      width: 100%;
      height: 100%;
      text-align: center;
      font-size: 20px;
      font-weight: 700;
      font-family: 'Work Sans', sans-serif;
      text-transform: uppercase;
      border: none;
      background: var(--input);
      color: var(--foreground);
      border-radius: calc(var(--radius) - 2px);
      transition: all 0.2s ease;
      border: 2px solid transparent;
    }

    .grid-input:focus {
      outline: none;
      background: var(--accent);
      color: var(--accent-foreground);
      border-color: var(--accent);
      box-shadow: 0 0 0 2px var(--ring);
    }

    /* Added green styling for typed letters */
    .grid-input.typed {
      background: #22c55e !important;
      color: white !important;
      border-color: #16a34a !important;
    }

    /* Added styling for permanently locked letters */
    .grid-input.locked {
      background: var(--muted) !important;
      color: var(--muted-foreground) !important;
      border-color: var(--border) !important;
      font-weight: 600;
    }

    .col-label {
      width: 52px;
      text-align: center;
      font-size: 14px;
      padding: 5px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Added dark mode player turn backgrounds */
    [data-theme="dark"] body.player1-turn {
      background: linear-gradient(135deg, #1e1b1b 0%, #2d1b1b 100%);
    }

    [data-theme="dark"] body.player2-turn {
      background: linear-gradient(135deg, #1b1e2e 0%, #1b2137 100%);
    }

    /* Added theme toggle button styling */
    .theme-toggle {
      position: absolute;
      top: 0;
      right: 20px;
      width: 44px;
      height: 44px;
      border: none;
      border-radius: 50%;
      background: var(--card);
      color: var(--foreground);
      font-size: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px solid var(--border);
    }

    .theme-toggle:hover {
      background: var(--accent);
      color: var(--accent-foreground);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    /* Timer section styling for centering */
    .timer-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 30px;
      gap: 15px;
    }

    .timer-display {
      font-family: 'Work Sans', sans-serif;
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--primary);
      text-align: center;
    }

    .progress-controls {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .progress-bar-container {
      width: 300px;
      height: 8px;
      background: var(--border);
      border-radius: 4px;
      overflow: hidden;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--player1-color), var(--player2-color));
      width: 100%;
      transition: width 0.3s ease;
    }

    /* Enhanced contrast for dark mode */
    [data-theme="dark"] .grid-input {
      background: var(--card);
      color: var(--card-foreground);
      border: 2px solid var(--border);
    }

    [data-theme="dark"] .grid-input:focus {
      background: var(--accent);
      color: var(--accent-foreground);
      border-color: var(--accent);
    }

    @media (max-width: 768px) {
      .game-container {
        flex-direction: column;
        align-items: center;
        gap: 20px;
      }
      
      .player-section {
        width: 100%;
        max-width: 400px;
      }
      
      .progress-bar-container {
        width: 250px;
      }
      
      .game-title {
        font-size: 2rem;
      }

      .rules-list {
        grid-template-columns: 1fr;
      }

      /* Added mobile responsive styling for theme toggle */
      .theme-toggle {
        position: static;
        margin: 10px auto 0 auto;
      }

      .game-header {
        display: flex;
        flex-direction: column;
        align-items: center;
      }
    }
  </style>
</head>
<body>
  <div class="game-header">
    <h1 class="game-title">Word Battle Arena</h1>
    <!-- Added theme toggle button with sun/moon icons -->
    <button class="theme-toggle" id="themeToggle" title="Toggle dark mode">
      <span id="themeIcon">☀️</span>
    </button>
  </div>

  <!-- Added rules section -->
  <div class="rules-section">
    <h2 class="rules-title">Game Rules</h2>
    <ul class="rules-list">
      <li>No Repeats</li>
      <li>No Proper Nouns</li>
      <li>No Abbreviations</li>
      <li>No Acronyms</li>
      <li>No adding "S" to make plurals</li>
    </ul>
  </div>

  <!-- Wrapped timer elements in centered section -->
  <div class="timer-section">
    <div class="timer-display" id="timer">Time Left: 2:00</div>
    <div class="progress-controls">
      <div class="progress-bar-container">
        <div class="progress-bar" id="progressBar"></div>
      </div>
      <button class="game-btn" id="startBtn">Start Game</button>
      <button class="pause-btn" id="pauseBtn" title="Pause" disabled>⏸</button>
    </div>
  </div>

  <div class="game-container">
    <div class="player-section player1" id="player1Section">
      <!-- Changed from Player 1 to Red Team -->
      <div class="player-header">Red Team</div>
      <input type="text" class="word-input" id="leftInput" placeholder="Enter your word..." disabled />
      <div class="word-list" id="leftWordList"></div>
      <div class="score-display">Score: <span id="leftScore">0</span></div>
      <!-- Added End Turn button -->
      <button class="end-turn-btn" id="leftEndTurn" disabled>End Turn</button>
    </div>

    <div class="grid-section">
      <div class="grid-header">Letter Grid</div>
      <div class="coordinates">
        <div style="width: 60px;"></div>
        <div style="display: flex;">
          <!-- Changed column coordinates from A,B,C,D,E,F to 10,20,30,40,50,60 -->
          <div class="col-label">10</div>
          <div class="col-label">20</div>
          <div class="col-label">30</div>
          <div class="col-label">40</div>
          <div class="col-label">50</div>
          <div class="col-label">60</div>
        </div>
      </div>
      <div class="grid-with-labels">
        <div class="row-labels">
          <!-- Changed row coordinates from A,B,C,D,E,F to 1,2,3,4,5,6 -->
          <div class="row-label">1</div>
          <div class="row-label">2</div>
          <div class="row-label">3</div>
          <div class="row-label">4</div>
          <div class="row-label">5</div>
          <div class="row-label">6</div>
        </div>
        <div class="grid" id="grid"></div>
      </div>
    </div>

    <div class="player-section player2" id="player2Section">
      <!-- Changed from Player 2 to Blue Team -->
      <div class="player-header">Blue Team</div>
      <input type="text" class="word-input" id="rightInput" placeholder="Enter your word..." disabled />
      <div class="word-list" id="rightWordList"></div>
      <div class="score-display">Score: <span id="rightScore">0</span></div>
      <!-- Added End Turn button -->
      <button class="end-turn-btn" id="rightEndTurn" disabled>End Turn</button>
    </div>
  </div>

  <script>
    // Build 6x6 grid dynamically
    const gridContainer = document.getElementById("grid");
    for (let i = 0; i < 36; i++) {
      const cell = document.createElement("div");
      cell.className = "grid-cell";
      const input = document.createElement("input");
      input.type = "text";
      input.className = "grid-input";
      input.maxLength = 1;
      input.disabled = true; // Grid starts disabled
      cell.appendChild(input);
      gridContainer.appendChild(cell);
    }

    let isPlayer1Turn = true;
    let timeLeft = 120;
    let countdownInterval;
    let isPaused = false;
    let gameStarted = false; // Added game state tracking
    let turnNumber = 1;
    let lettersPlacedThisTurn = 0;
    let maxLettersThisTurn = 2; // First turn allows 2 letters
    let modifiedCellsThisTurn = new Set(); // Track which cells were modified this turn
    let permanentlyLockedCells = new Set(); // Track cells that can never be changed

    const progressBar = document.getElementById("progressBar");
    const timerDisplay = document.getElementById("timer");
    const pauseBtn = document.getElementById("pauseBtn");
    const startBtn = document.getElementById("startBtn");
    const player1Section = document.getElementById("player1Section");
    const player2Section = document.getElementById("player2Section");
    const leftInput = document.getElementById("leftInput");
    const rightInput = document.getElementById("rightInput");
    const leftEndTurn = document.getElementById("leftEndTurn");
    const rightEndTurn = document.getElementById("rightEndTurn");
    const themeToggle = document.getElementById('themeToggle');
    const themeIcon = document.getElementById('themeIcon');

    function updateTimerDisplay() {
      const minutes = Math.floor(timeLeft / 60);
      const seconds = timeLeft % 60;
      timerDisplay.textContent = `Time Left: ${minutes}:${seconds.toString().padStart(2, '0')}`;
      progressBar.style.width = `${(timeLeft / 120) * 100}%`;
    }

    function updatePlayerTurn() {
      document.body.className = isPlayer1Turn ? 'player1-turn' : 'player2-turn';
      
      if (isPlayer1Turn) {
        player1Section.classList.add('active');
        player2Section.classList.remove('active');
      } else {
        player2Section.classList.add('active');
        player1Section.classList.remove('active');
      }
    }

    function updateGridState() {
      document.querySelectorAll(".grid-input").forEach((input, index) => {
        if (permanentlyLockedCells.has(index)) {
          input.disabled = true;
        } else {
          input.disabled = !gameStarted;
        }
      });
    }

    function endTurn() {
      document.querySelectorAll(".grid-input").forEach((input, index) => {
        if (input.value.trim() !== '') {
          permanentlyLockedCells.add(index);
          input.disabled = true;
          input.classList.remove('typed'); // Remove green styling
          input.classList.add('locked'); // Add locked styling
        }
      });

      turnNumber++;
      lettersPlacedThisTurn = 0;
      maxLettersThisTurn = 1; // After first turn, only 1 letter per turn
      modifiedCellsThisTurn.clear();
      
      document.querySelectorAll(".grid-input").forEach((input, index) => {
        if (!permanentlyLockedCells.has(index)) {
          input.disabled = true;
          input.style.backgroundColor = '';
          input.classList.remove('typed'); // Remove green styling
        }
      });
      
      isPlayer1Turn = !isPlayer1Turn;
      updatePlayerTurn();
      timeLeft = 120;
      updateTimerDisplay();
      
      setTimeout(() => {
        if (gameStarted) {
          updateGridState();
        }
      }, 100);
    }

    function startTimer() {
      if (!gameStarted) return;
      
      clearInterval(countdownInterval);
      countdownInterval = setInterval(() => {
        if (!isPaused) {
          timeLeft--;
          updateTimerDisplay();

          if (timeLeft === 0) {
            endTurn();
          }
        }
      }, 1000);
    }

    startBtn.addEventListener("click", () => {
      gameStarted = true;
      startBtn.disabled = true;
      pauseBtn.disabled = false;
      leftInput.disabled = false;
      rightInput.disabled = false;
      leftEndTurn.disabled = false;
      rightEndTurn.disabled = false;
      
      updateGridState();
      
      startTimer();
    });

    pauseBtn.addEventListener("click", () => {
      isPaused = !isPaused;
      pauseBtn.innerHTML = isPaused ? "▶" : "⏸";
      pauseBtn.title = isPaused ? "Resume" : "Pause";
    });

    leftEndTurn.addEventListener("click", () => {
      if (gameStarted && isPlayer1Turn) {
        endTurn();
      }
    });

    rightEndTurn.addEventListener("click", () => {
      if (gameStarted && !isPlayer1Turn) {
        endTurn();
      }
    });

    document.querySelectorAll(".grid-input").forEach((input, index) => {
      input.addEventListener("keypress", (event) => {
        if (input.disabled || permanentlyLockedCells.has(index)) {
          event.preventDefault();
          return;
        }
        
        if (event.key === "Enter" && gameStarted) {
          endTurn();
          return;
        }
        
        if (!/^[a-zA-Z]$/.test(event.key)) {
          event.preventDefault();
          return;
        }
      });

      input.addEventListener("input", (event) => {
        if (!gameStarted || input.disabled || permanentlyLockedCells.has(index)) {
          event.target.value = '';
          return;
        }
        
        const value = event.target.value.toUpperCase();
        
        if (value && !/^[A-Z]$/.test(value)) {
          event.target.value = '';
          return;
        }
        
        if (value && !modifiedCellsThisTurn.has(index)) {
          if (lettersPlacedThisTurn >= maxLettersThisTurn) {
            event.target.value = '';
            event.target.style.backgroundColor = '#fee2e2';
            setTimeout(() => {
              event.target.style.backgroundColor = '';
            }, 1000);
            return;
          }
          
          modifiedCellsThisTurn.add(index);
          lettersPlacedThisTurn++;
          event.target.classList.add('typed');
        } else if (!value && modifiedCellsThisTurn.has(index)) {
          modifiedCellsThisTurn.delete(index);
          lettersPlacedThisTurn--;
          event.target.classList.remove('typed');
        }
        
        event.target.value = value;
      });
    });

    let allWords = new Set();

    function processInput(inputId, wordListId, scoreId) {
      const input = document.getElementById(inputId);
      const wordList = document.getElementById(wordListId);
      const scoreDisplay = document.getElementById(scoreId);

      input.addEventListener("keypress", function(event) {
        if (event.key === "Enter" && gameStarted) {
          const word = input.value.toUpperCase().trim();
          if (word && !allWords.has(word)) {
            allWords.add(word);
            
            const wordSpan = document.createElement('span');
            wordSpan.textContent = word;
            wordSpan.style.marginRight = '8px';
            wordSpan.style.padding = '2px 6px';
            wordSpan.style.backgroundColor = 'var(--accent)';
            wordSpan.style.color = 'var(--accent-foreground)';
            wordSpan.style.borderRadius = '4px';
            wordSpan.style.fontSize = '12px';
            wordSpan.style.fontWeight = '500';
            wordSpan.style.display = 'inline-block';
            wordSpan.style.marginBottom = '4px';
            
            wordList.appendChild(wordSpan);
            
            const score = word.length;
            scoreDisplay.textContent = parseInt(scoreDisplay.textContent) + score;
            input.value = "";
          } else if (word) {
            input.style.borderColor = 'var(--player1-color)';
            setTimeout(() => {
              input.style.borderColor = 'var(--border)';
            }, 1000);
          }
        }
      });
    }

    processInput("leftInput", "leftWordList", "leftScore");
    processInput("rightInput", "rightWordList", "rightScore");

    // Load saved theme or default to light
    const savedTheme = localStorage.getItem('theme') || 'light';
    document.documentElement.setAttribute('data-theme', savedTheme);
    themeIcon.textContent = savedTheme === 'dark' ? '🌙' : '☀️';
    
    themeToggle.addEventListener('click', () => {
      const currentTheme = document.documentElement.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      
      document.documentElement.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
      themeIcon.textContent = newTheme === 'dark' ? '🌙' : '☀️';
    });

    updateTimerDisplay();
    updatePlayerTurn();
  </script>
</body>
</html>
