<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deal or No Deal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0a0a2a;
            color: #f0f0f0;
            overflow: hidden;
        }
        .briefcase.player-case {
            background: linear-gradient(145deg, #1e3a8a, #3b82f6);
            border-color: #fbbf24;
        }
        .money-amount {
            background-color: #1f2937;
            transition: all 0.3s ease-in-out;
        }
        .money-amount.eliminated {
            background-color: #ef4444;
            color: #1f2937;
            text-decoration: line-through;
            transform: scale(1);
        }
        .money-amount.highlighted {
            background-color: #facc15; /* yellow-400 */
            color: #111827; /* gray-900 */
            transform: scale(1.1);
            box-shadow: 0 0 15px #facc15;
        }
        .modal-bg {
            background-color: rgba(0, 0, 0, 0.8);
        }
        .banker-phone {
            filter: drop-shadow(0 0 15px #facc15);
        }
        
        /* --- Briefcase Flip Animation --- */
        .briefcase-container {
            perspective: 1000px;
            width: 100%;
            height: 4rem; /* h-16 */
        }
        @media (min-width: 768px) { /* md breakpoint */
            .briefcase-container {
                height: 5rem; /* h-20 */
            }
        }
        .briefcase-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.8s;
            transform-style: preserve-3d;
        }
        .briefcase-container.flipping .briefcase-inner {
            transform: rotateY(180deg);
        }
        .briefcase-front, .briefcase-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.4), inset 0 2px 4px rgba(255,255,255,0.3);
        }
        .briefcase-front {
            background: linear-gradient(145deg, #d4af37, #b8860b);
            border: 2px solid #a16207;
        }
        .briefcase-back {
            background: #4b5563;
            transform: rotateY(180deg);
            border: 2px solid #a16207;
        }
        .briefcase-container:not(.opened):hover .briefcase-front {
             transform: scale(1.05) translateY(-5px);
             box-shadow: 0 8px 12px rgba(0,0,0,0.5), inset 0 2px 4px rgba(255,255,255,0.4);
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-2 md:p-4">

    <div id="game-container" class="w-full max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-4">

        <!-- Left Money Panel -->
        <div id="money-panel-left" class="lg:col-span-2 order-2 lg:order-1 bg-gray-900/50 p-3 rounded-lg shadow-lg flex flex-col justify-center items-center"></div>

        <!-- Center Game Area -->
        <div class="lg:col-span-8 order-1 lg:order-2 flex flex-col gap-4">
            <div id="message-box" class="text-center bg-black/60 p-4 rounded-lg shadow-xl min-h-[80px] flex items-center justify-center">
                <h2 id="message-text" class="text-xl md:text-2xl font-bold text-yellow-400 tracking-wider"></h2>
            </div>
            <div id="briefcase-grid" class="grid grid-cols-4 sm:grid-cols-5 md:grid-cols-6 lg:grid-cols-7 gap-2 md:gap-4 p-4 bg-gray-800/50 rounded-lg"></div>
            <div class="flex flex-col md:flex-row items-center justify-around gap-4 mt-4 min-h-[148px]">
                <div class="text-center">
                    <h3 class="text-lg font-semibold uppercase tracking-widest">Your Case</h3>
                    <div id="player-case-display" class="w-32 h-24 md:w-40 md:h-28 mt-2"></div>
                </div>
                 <div id="offer-display" class="hidden text-center">
                    <h3 class="text-lg font-semibold uppercase tracking-widest">Banker's Offer</h3>
                    <p id="offer-amount" class="text-4xl font-black text-green-400 my-2"></p>
                    <div class="flex gap-4">
                        <button id="deal-button" class="bg-green-600 hover:bg-green-500 text-white font-bold py-3 px-8 rounded-lg shadow-lg transition-transform transform hover:scale-105">DEAL</button>
                        <button id="no-deal-button" class="bg-red-700 hover:bg-red-600 text-white font-bold py-3 px-8 rounded-lg shadow-lg transition-transform transform hover:scale-105">NO DEAL</button>
                    </div>
                </div>
                <div id="end-game-controls" class="hidden text-center">
                    <button id="new-game-button" class="bg-yellow-500 hover:bg-yellow-400 text-black font-bold py-3 px-8 rounded-lg shadow-lg transition-transform transform hover:scale-105">New Game</button>
                </div>
            </div>
        </div>

        <!-- Right Money Panel -->
        <div id="money-panel-right" class="lg:col-span-2 order-3 lg:order-3 bg-gray-900/50 p-3 rounded-lg shadow-lg flex flex-col justify-center items-center"></div>
    </div>

    <!-- Final Choice Modal -->
    <div id="final-choice-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-bg">
        <div class="bg-gray-800 rounded-lg shadow-2xl p-8 text-center max-w-lg mx-4">
            <h2 class="text-3xl font-bold mb-4 text-yellow-400">The Final Decision</h2>
            <p class="text-lg mb-6">You have one case left besides your own. The banker's final offer is off the table. You can either keep your case or swap it for the last one on the stage.</p>
            <div class="flex justify-center gap-6">
                <button id="keep-case-button" class="bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 px-8 rounded-lg shadow-lg transition-transform transform hover:scale-105">Keep My Case</button>
                <button id="swap-case-button" class="bg-purple-600 hover:bg-purple-500 text-white font-bold py-3 px-8 rounded-lg shadow-lg transition-transform transform hover:scale-105">Swap Cases</button>
            </div>
        </div>
    </div>
    
    <!-- Banker Calling Modal -->
    <div id="banker-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-bg">
        <div class="bg-transparent rounded-lg p-8 text-center flex flex-col items-center">
            <svg class="w-24 h-24 text-yellow-400 animate-pulse banker-phone" xmlns="http://www.w.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 6.75z" />
            </svg>
            <h2 class="text-3xl font-bold mt-4 text-yellow-400 animate-pulse">The Banker is Calling...</h2>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- GAME CONFIGURATION ---
            const moneyValues = [0.01, 1, 5, 10, 25, 50, 75, 100, 200, 300, 400, 500, 750, 1000, 5000, 10000, 25000, 50000, 75000, 100000, 200000, 300000, 400000, 500000, 750000, 1000000];
            const casesToOpenPerRound = [6, 5, 4, 3, 2, 1, 1, 1, 1];
            const TOTAL_CASES = 26;

            // --- DOM ELEMENTS ---
            const briefcaseGrid = document.getElementById('briefcase-grid');
            const moneyPanelLeft = document.getElementById('money-panel-left');
            const moneyPanelRight = document.getElementById('money-panel-right');
            const messageText = document.getElementById('message-text');
            const playerCaseDisplay = document.getElementById('player-case-display');
            const offerDisplay = document.getElementById('offer-display');
            const offerAmount = document.getElementById('offer-amount');
            const dealButton = document.getElementById('deal-button');
            const noDealButton = document.getElementById('no-deal-button');
            const finalChoiceModal = document.getElementById('final-choice-modal');
            const keepCaseButton = document.getElementById('keep-case-button');
            const swapCaseButton = document.getElementById('swap-case-button');
            const bankerModal = document.getElementById('banker-modal');
            const endGameControls = document.getElementById('end-game-controls');
            const newGameButton = document.getElementById('new-game-button');

            // --- GAME STATE ---
            let gameState = 'pick-case'; // 'pick-case', 'open-cases', 'banker-offer', 'final-choice', 'game-over', 'animating'
            let briefcases = [];
            let playerCase = null;
            let currentRound = 0;
            let casesToOpenThisRound = 0;
            let casesOpenedThisRound = 0;
            
            function shuffle(array) { return array.sort(() => Math.random() - 0.5); }
            function formatCurrency(value) { return value.toLocaleString('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 0, maximumFractionDigits: 0 }); }

            function initGame() {
                gameState = 'pick-case';
                briefcases = [];
                playerCase = null;
                currentRound = 0;
                casesOpenedThisRound = 0;
                offerDisplay.classList.add('hidden');
                finalChoiceModal.classList.add('hidden');
                endGameControls.classList.add('hidden');
                playerCaseDisplay.innerHTML = '';
                
                const shuffledMoney = shuffle([...moneyValues]);
                for (let i = 0; i < TOTAL_CASES; i++) {
                    briefcases.push({ id: i + 1, value: shuffledMoney[i], isOpen: false });
                }

                renderMoneyPanels();
                renderBriefcases();
                updateMessage(`Welcome! Please pick a briefcase to keep.`);
            }

            function renderMoneyPanels() {
                moneyPanelLeft.innerHTML = '';
                moneyPanelRight.innerHTML = '';
                const sortedValues = [...moneyValues].sort((a, b) => a - b);
                
                sortedValues.forEach((value, index) => {
                    const moneyDiv = document.createElement('div');
                    moneyDiv.id = `money-${value}`;
                    moneyDiv.className = 'money-amount text-center font-bold text-sm md:text-base py-1 px-2 my-1 rounded-md w-full';
                    moneyDiv.textContent = formatCurrency(value);
                    
                    const panel = index < sortedValues.length / 2 ? moneyPanelLeft : moneyPanelRight;
                    panel.appendChild(moneyDiv);
                });
            }

            function renderBriefcases() {
                briefcaseGrid.innerHTML = '';
                briefcases.forEach(bCase => {
                    const caseContainer = document.createElement('div');
                    caseContainer.dataset.id = bCase.id;
                    caseContainer.className = 'briefcase-container cursor-pointer';
                    caseContainer.innerHTML = `
                        <div class="briefcase-inner">
                            <div class="briefcase-front">
                                <span class="text-2xl md:text-3xl font-black text-gray-800">${bCase.id}</span>
                            </div>
                            <div class="briefcase-back">
                                <span class="briefcase-value text-sm md:text-base font-bold text-yellow-300"></span>
                            </div>
                        </div>
                    `;
                    caseContainer.addEventListener('click', () => handleCaseClick(bCase.id));
                    briefcaseGrid.appendChild(caseContainer);
                });
            }

            function handleCaseClick(caseId) {
                const selectedCase = briefcases.find(b => b.id === caseId);

                if (gameState === 'animating' || gameState === 'game-over' || selectedCase.isOpen || (playerCase && selectedCase.id === playerCase.id)) {
                    return;
                }

                if (gameState === 'pick-case') {
                    playerCase = selectedCase;
                    const playerCaseDiv = document.createElement('div');
                    playerCaseDiv.className = 'briefcase player-case flex items-center justify-center w-full h-full rounded-lg border-4';
                    playerCaseDiv.innerHTML = `<span class="text-3xl md:text-4xl font-black text-white">${playerCase.id}</span>`;
                    playerCaseDisplay.innerHTML = '';
                    playerCaseDisplay.appendChild(playerCaseDiv);
                    
                    briefcaseGrid.querySelector(`[data-id='${caseId}']`).style.visibility = 'hidden';
                    startRound();

                } else if (gameState === 'open-cases') {
                    animateAndOpenCase(selectedCase);
                }
            }
            
            function animateAndOpenCase(bCase) {
                gameState = 'animating';
                bCase.isOpen = true;
                casesOpenedThisRound++;

                const caseContainer = briefcaseGrid.querySelector(`[data-id='${bCase.id}']`);
                const moneyDiv = document.getElementById(`money-${bCase.value}`);

                moneyDiv.classList.add('highlighted');
                caseContainer.classList.add('flipping', 'opened');
                caseContainer.classList.remove('cursor-pointer');

                setTimeout(() => {
                    const valueSpan = caseContainer.querySelector('.briefcase-value');
                    valueSpan.textContent = formatCurrency(bCase.value);
                }, 400); // Halfway through the flip

                setTimeout(() => {
                    moneyDiv.classList.remove('highlighted');
                    moneyDiv.classList.add('eliminated');
                    checkRoundStatus();
                }, 1500); // After flip and highlight
            }

            function checkRoundStatus() {
                if (casesOpenedThisRound >= casesToOpenThisRound) {
                    if (briefcases.filter(b => !b.isOpen && b.id !== playerCase.id).length > 1) {
                        gameState = 'banker-offer';
                        showBankerCalling();
                    } else {
                        gameState = 'final-choice';
                        showFinalChoice();
                    }
                } else {
                    gameState = 'open-cases';
                    updateMessage(`Open ${casesToOpenThisRound - casesOpenedThisRound} more case(s).`);
                }
            }

            function startRound() {
                casesToOpenThisRound = casesToOpenPerRound[currentRound];
                casesOpenedThisRound = 0;
                gameState = 'open-cases';
                updateMessage(`Round ${currentRound + 1}. Please open ${casesToOpenThisRound} case(s).`);
            }

            function showBankerCalling() {
                updateMessage('The Banker is considering an offer...');
                bankerModal.style.display = 'flex';
                setTimeout(() => {
                    bankerModal.style.display = 'none';
                    makeBankerOffer();
                }, 2500);
            }

            function makeBankerOffer() {
                const remainingValues = briefcases.filter(b => !b.isOpen).map(b => b.value);
                const expectedValue = remainingValues.reduce((sum, val) => sum + val, 0) / remainingValues.length;
                const offerPercentage = (currentRound + 1) * 0.1 + 0.25;
                const offer = Math.round(expectedValue * Math.min(offerPercentage, 0.95));

                offerAmount.textContent = formatCurrency(offer);
                offerDisplay.classList.remove('hidden');
                updateMessage(`The Banker offers you ${formatCurrency(offer)}.`);
            }
            
            function showFinalChoice() {
                updateMessage('The final choice is yours!');
                finalChoiceModal.style.display = 'flex';
            }

            function revealAllCases() {
                // Reveal player case
                playerCaseDisplay.innerHTML = `<div class="briefcase player-case flex flex-col items-center justify-center w-full h-full rounded-lg border-4"><span class="text-sm">Your Case</span><span class="text-2xl font-bold text-yellow-300">${formatCurrency(playerCase.value)}</span></div>`;

                // Reveal all other unopened cases on the grid
                briefcases.forEach(bCase => {
                    if (!bCase.isOpen && bCase.id !== playerCase.id) {
                        const caseContainer = briefcaseGrid.querySelector(`[data-id='${bCase.id}']`);
                        caseContainer.classList.add('flipping', 'opened');
                        const valueSpan = caseContainer.querySelector('.briefcase-value');
                        valueSpan.textContent = formatCurrency(bCase.value);
                    }
                });
            }

            function endGame(reason, amountWon) {
                gameState = 'game-over';
                offerDisplay.classList.add('hidden');
                finalChoiceModal.style.display = 'none';

                const remainingCase = briefcases.find(b => !b.isOpen && b.id !== playerCase.id);
                let finalMessage = ``;

                if (reason === 'deal') {
                    finalMessage = `You took the deal and won ${formatCurrency(amountWon)}! Your case contained ${formatCurrency(playerCase.value)}.`;
                } else {
                    finalMessage = `You won ${formatCurrency(amountWon)}! Your case had ${formatCurrency(playerCase.value)}.`;
                    if (reason === 'swap') {
                        finalMessage = `You swapped and won ${formatCurrency(amountWon)}! Your original case had ${formatCurrency(playerCase.value)}.`;
                    }
                }
                
                updateMessage(finalMessage);
                revealAllCases();
                endGameControls.classList.remove('hidden');
            }

            function updateMessage(text) { messageText.innerHTML = text; }

            // --- EVENT LISTENERS ---
            dealButton.addEventListener('click', () => {
                const amount = parseFloat(offerAmount.textContent.replace(/[^0-9.-]+/g,""));
                endGame('deal', amount);
            });

            noDealButton.addEventListener('click', () => {
                offerDisplay.classList.add('hidden');
                currentRound++;
                startRound();
            });
            
            keepCaseButton.addEventListener('click', () => endGame('keep', playerCase.value));
            swapCaseButton.addEventListener('click', () => {
                const lastCase = briefcases.find(b => !b.isOpen && b.id !== playerCase.id);
                endGame('swap', lastCase.value);
            });
            
            newGameButton.addEventListener('click', initGame);

            initGame();
        });
    </script>
</body>
</html>
