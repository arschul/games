<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1001 Conversation Questions</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;700&family=DM+Sans:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --background: #ffffff;
            --foreground: #475569;
            --card: #ecfeff;
            --card-foreground: #164e63;
            --popover: #ffffff;
            --popover-foreground: #475569;
            --primary: #164e63;
            --primary-foreground: #ffffff;
            --secondary: #f59e0b;
            --secondary-foreground: #ffffff;
            --muted: #f8fafc;
            --muted-foreground: #374151;
            --accent: #f59e0b;
            --accent-foreground: #ffffff;
            --destructive: #dc2626;
            --destructive-foreground: #ffffff;
            --border: #e5e7eb;
            --input: #f1f5f9;
            --ring: rgba(22, 78, 99, 0.5);
            --radius: 0.5rem;
        }

        .dark {
            --background: #0f172a;
            --foreground: #e2e8f0;
            --card: #1e293b;
            --card-foreground: #e2e8f0;
            --primary: #0ea5e9;
            --primary-foreground: #ffffff;
            --muted: #334155;
            --muted-foreground: #94a3b8;
            --border: #334155;
            --input: #334155;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'DM Sans', sans-serif;
            background-color: var(--background);
            color: var(--foreground);
            line-height: 1.6;
            min-height: 100vh;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        header {
            background-color: var(--background);
            border-bottom: 1px solid var(--border);
            padding: 1.5rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        h1 {
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 700;
            font-size: 2rem;
            color: var(--primary);
        }

        .tagline {
            color: var(--muted-foreground);
            font-size: 0.875rem;
        }

        /* Added theme toggle button */
        .theme-toggle {
            background: none;
            border: 1px solid var(--border);
            color: var(--foreground);
            padding: 0.5rem;
            border-radius: var(--radius);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1.25rem;
            width: 2.5rem;
            height: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .theme-toggle:hover {
            background-color: var(--muted);
        }

        /* Added stopwatch styles */
        .header-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .stopwatch-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background-color: var(--card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 0.5rem 1rem;
        }

        .stopwatch-display {
            font-family: 'Space Grotesk', monospace;
            font-weight: 700;
            font-size: 1rem;
            color: var(--primary);
            min-width: 4rem;
            text-align: center;
        }

        .stopwatch-btn {
            background: none;
            border: 1px solid var(--border);
            color: var(--foreground);
            padding: 0.25rem 0.5rem;
            border-radius: calc(var(--radius) - 2px);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .stopwatch-btn:hover {
            background-color: var(--muted);
        }

        .stopwatch-btn.active {
            background-color: var(--primary);
            color: var(--primary-foreground);
        }

        main {
            padding: 2rem 0;
            /* Changed to full height layout with top/bottom split */
            height: calc(100vh - 200px);
            display: flex;
            flex-direction: column;
        }

        /* Updated layout to vertical split instead of horizontal grid */
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            gap: 2rem;
        }

        .categories-section {
            background-color: var(--card);
            border-radius: var(--radius);
            padding: 1.5rem;
            /* Changed from flex: 1 to fixed proportion - takes up top third */
            flex: 0 0 33%;
            overflow-y: auto;
        }

        .section-title {
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 700;
            font-size: 1.25rem;
            color: var(--card-foreground);
            margin-bottom: 1rem;
        }

        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 0.75rem;
        }

        .category-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            border-radius: calc(var(--radius) - 2px);
            transition: background-color 0.2s ease;
            cursor: pointer;
        }

        .category-item:hover {
            background-color: var(--muted);
        }

        .category-checkbox {
            width: 1.25rem;
            height: 1.25rem;
            accent-color: var(--primary);
            cursor: pointer;
        }

        .category-label {
            font-weight: 500;
            color: var(--card-foreground);
            cursor: pointer;
            flex: 1;
        }

        .question-section {
            /* Changed from flex: 1 to take remaining two-thirds of screen */
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .question-card {
            background-color: var(--card);
            border-radius: var(--radius);
            padding: 3rem;
            /* Takes up most of the bottom section */
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            position: relative;
            /* Added min-height to prevent layout shifts during loading */
            min-height: 200px;
        }

        .question-text {
            /* Made question text much bigger and more prominent */
            font-size: 1.5rem;
            line-height: 1.6;
            color: var(--card-foreground);
            max-width: 100%;
            font-weight: 500;
            /* Added transition to smooth content changes */
            transition: opacity 0.2s ease;
        }

        .placeholder-text {
            color: var(--muted-foreground);
            font-style: italic;
            font-size: 1.25rem;
        }

        .generate-button {
            background-color: var(--primary);
            color: var(--primary-foreground);
            border: none;
            border-radius: var(--radius);
            padding: 1rem 2rem;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(22, 78, 99, 0.2);
            align-self: center;
        }

        .generate-button:hover {
            background-color: #0f3a47;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(22, 78, 99, 0.3);
        }

        .generate-button:disabled {
            background-color: var(--muted);
            color: var(--muted-foreground);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .controls {
            display: flex;
            gap: 1rem;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        .select-all-btn, .clear-all-btn {
            background: none;
            border: 1px solid var(--border);
            color: var(--foreground);
            padding: 0.5rem 1rem;
            border-radius: calc(var(--radius) - 2px);
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .select-all-btn:hover, .clear-all-btn:hover {
            background-color: var(--muted);
        }

        /* Added history section styles */
        .history-toggle {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: 1px solid var(--border);
            color: var(--card-foreground);
            padding: 0.5rem 1rem;
            border-radius: calc(var(--radius) - 2px);
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .history-toggle:hover {
            background-color: var(--muted);
        }

        .history-panel {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--card);
            border-radius: var(--radius);
            padding: 2rem;
            display: none;
            flex-direction: column;
            gap: 1rem;
            overflow-y: auto;
        }

        .history-panel.show {
            display: flex;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
            padding-bottom: 1rem;
        }

        .history-title {
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 700;
            font-size: 1.25rem;
            color: var(--card-foreground);
        }

        .close-history {
            background: none;
            border: none;
            color: var(--card-foreground);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.25rem;
        }

        .history-list {
            flex: 1;
            overflow-y: auto;
        }

        .history-item {
            padding: 1rem;
            border: 1px solid var(--border);
            border-radius: calc(var(--radius) - 2px);
            margin-bottom: 1rem;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .history-item:hover {
            background-color: var(--muted);
        }

        .history-category {
            font-size: 0.875rem;
            color: var(--muted-foreground);
            margin-bottom: 0.5rem;
        }

        .history-question {
            font-size: 1rem;
            color: var(--card-foreground);
        }

        .error-message {
            background-color: var(--destructive);
            color: var(--destructive-foreground);
            padding: 1rem;
            border-radius: var(--radius);
            text-align: center;
            margin-bottom: 1rem;
        }

        footer {
            background-color: var(--background);
            border-top: 1px solid var(--border);
            padding: 2rem 0;
            text-align: center;
            color: var(--muted-foreground);
            font-size: 0.875rem;
        }

        .loading {
            opacity: 0.6;
            pointer-events: none;
            /* Removed any transform that could cause jumping */
        }

        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Mobile responsive adjustments */
        @media (max-width: 768px) {
            main {
                height: calc(100vh - 160px);
            }
            
            .question-text {
                font-size: 1.25rem;
            }
            
            .categories-grid {
                grid-template-columns: 1fr;
            }
            
            .question-card {
                padding: 2rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div>
                    <h1>1001 Conversation Questions</h1>
                    <p class="tagline">Generate meaningful conversation starters from curated categories</p>
                </div>
                <!-- Added stopwatch controls beside theme toggle -->
                <div class="header-controls">
                    <div class="stopwatch-container">
                        <div class="stopwatch-display" id="stopwatchDisplay">00:00</div>
                        <button class="stopwatch-btn" id="stopwatchBtn" onclick="toggleStopwatch()">Start</button>
                        <button class="stopwatch-btn" onclick="resetStopwatch()">Reset</button>
                    </div>
                    <button class="theme-toggle" onclick="toggleTheme()" title="Toggle dark/light mode">
                        <span id="themeIcon">☀️</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main>
        <div class="container">
            <!-- Changed layout to vertical split -->
            <div class="app-container">
                <div class="categories-section">
                    <h2 class="section-title">Select Categories</h2>
                    <div class="controls">
                        <button class="select-all-btn" onclick="selectAllCategories()">Select All</button>
                        <button class="clear-all-btn" onclick="clearAllCategories()">Clear All</button>
                    </div>
                    <div class="categories-grid" id="categoriesGrid">
                        <!-- Categories will be populated by JavaScript -->
                    </div>
                </div>

                <div class="question-section">
                    <div class="question-card">
                        <!-- Added history toggle button -->
                        <button class="history-toggle" onclick="toggleHistory()">History</button>
                        
                        <div class="question-text placeholder-text" id="questionDisplay">
                            Select one or more categories and click "Generate Question" to get started!
                        </div>
                        
                        <!-- Added history panel -->
                        <div class="history-panel" id="historyPanel">
                            <div class="history-header">
                                <h3 class="history-title">Question History</h3>
                                <button class="close-history" onclick="toggleHistory()">×</button>
                            </div>
                            <div class="history-list" id="historyList">
                                <p class="placeholder-text">No questions generated yet.</p>
                            </div>
                        </div>
                    </div>
                    <button class="generate-button" id="generateBtn" onclick="generateQuestion()">
                        Generate Question
                    </button>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>Based on "The Complete Book of Questions" - Spark meaningful conversations</p>
        </div>
    </footer>

    <script>
        const questionsByCategory = {
            "Light & Easy": [
                "Do you squeeze the toothpaste tube or roll it? What's the advantage of your method?",
                "How many siblings do you have? What's your birth order?",
                "What's something you've won and how did you win it?",
                "What's one of your nicknames? What do you prefer to be called?",
                "What's something you intended to do today, but didn't? Why not?",
                "Using only one word per person, what was your first impression of each person present with you now?",
                "What's something that people do in traffic that really bothers you?",
                "What books on your shelf are begging to be read?",
                "What room in your house best reflects your personality? Explain why.",
                "How often do you doodle? What do your doodles usually look like?",
                "What do you do if you can't sleep at night? Do you count sheep, toss and turn, or get up and try to do something productive?",
                "Which do you do more often: hum or whistle? Hum or whistle your answer.",
                "What animal are you the most like? Why?",
                "How many days could you last in solitary confinement? How would you do it?",
                "Do you save old greeting cards and letters, or throw them all away? Why?",
                "On a scale of 1 to 10, how well do you sing?",
                "When you're alone at home, do you wear shoes, socks, slippers, or go barefoot?",
                "What are the advantages and disadvantages of being your height?",
                "When was the last picnic you went on? Describe it.",
                "How many discount or savings coupons do you clip in an average month? How many expire before you use them?"
            ],
            "Personal Profile": [
                "What drives you crazy?",
                "Are you serious-minded or a jokester? Why?",
                "Are you more likely to avoid conflict or engage in it head-on? Why?",
                "What was the most recent compliment you received and savored?",
                "What's something about yourself that you hope will change, but that probably never will?",
                "What's something about yourself that you hope will never change?",
                "Are you a leader or a follower? How do you know?",
                "Are you more of a rule breaker or a rule keeper? Why?",
                "Would you describe yourself as an extrovert or an introvert? Give an example.",
                "Would you describe yourself as more of a feeler or a thinker? Why?",
                "Are you usually late, early, or on time? Why?",
                "What goals have you recently set for yourself, and how are you doing on them so far?",
                "To what degree are you patriotic? How do you express your patriotism?",
                "Are you a creature of habit? Explain your answer.",
                "In what situations are you most likely to procrastinate?",
                "What books have made a big impact on you?",
                "At what age do you hope to retire? Explain.",
                "How much of a bargain hunter are you? Explain.",
                "How much of a shopper are you? Where's your favorite place to shop?",
                "Are you ever a high-maintenance person? Explain."
            ],
            "Preferences": [
                "What's your favorite ice-cream brand and flavor?",
                "What's your all-time favorite meal, and how often do you enjoy it?",
                "What's your all-time favorite movie, and how many times have you seen it?",
                "What's your dream job?",
                "When you need to confront someone, would you rather communicate in person, on the phone, by e-mail, or by letter? Why?",
                "Which do you prefer: the hustle and bustle of city life or the quiet and serenity of country life? Why?",
                "Do you read or study best in silence or in a place with background noise? Why?",
                "Do you prefer exercising your mind or your body? How frequently do you do either?",
                "Do you prefer that people shoot straight with you or carefully temper their words? Why?",
                "Are you more of a dog person or a cat person? Why?",
                "What's your preference: plane, train, boat, automobile, horse, or camel?",
                "How far in advance do you prefer to plan? Why?",
                "What's your favorite board game? Do you usually win?",
                "Who's your favorite talk show host?",
                "Are you a traveler or a homebody? Explain.",
                "Do you enjoy a good debate or prefer keeping the peace?",
                "What was your favorite recess activity: Dodgeball, Kickball, Four Square, Hopscotch, Freeze Tag, or jump rope?",
                "What's your favorite room in your home? Why?",
                "Where's your perfect dream vacation spot?",
                "Where's your favorite place to take out-of-town guests?"
            ],
            "Blast from the Past": [
                "What's one of your greatest achievements?",
                "What's your favorite birthday memory?",
                "Who was your best friend in high school, and where is he or she now?",
                "What was your first job? How much did you get paid?",
                "As a kid, what did you want to grow up to be?",
                "What photos do you cherish from the past? Where do you keep them now?",
                "Was there ever a time when it turned out you were right, in spite of many others who thought otherwise? Explain the situation.",
                "What one word sums up your high school experience?",
                "When was the last time you played hooky? Explain the situation.",
                "As a child, what was your idea of fun?",
                "When have you experienced poor customer service? How did you react?",
                "What do you remember about your first day of school or your first teacher?",
                "What's your most memorable (good or bad) airplane flight?",
                "How many bones have you broken? Share the details.",
                "What's something you've done that surprised even you?",
                "How many times have you had stitches, and what were the circumstances? Explain.",
                "What pets did you have growing up? What were their names?",
                "Have you ever seen or called a psychic? What was your experience like?",
                "Was school easy or difficult for you? How so?",
                "What kind of kids did you hang out with in high school?"
            ],
            "Just Imagine": [
                "If you could be invisible for a day, what would you do?",
                "If you could eliminate one weakness or limitation in your life, what would it be?",
                "If you could change anything about your relationship with your parents, what would it be?",
                "If you were able to switch job responsibilities with your boss, would you do it? Why or why not?",
                "If you were able to retrieve only one item on the way out of your burning home, what would that be? Explain.",
                "If you could go back in time, what year would you visit? Why?",
                "If you could go anywhere for a one-day visit, where would you go? Why?",
                "If you could spend one hour doing absolutely anything, what would you do?",
                "If you had the opportunity to travel into space, would you go? Why or why not?",
                "If you had an unlimited shopping spree at only one store, which one would you choose? Why?",
                "If you could play any instrument, what would you choose? Why?",
                "If you could talk with only one person for the rest of your life, who would it be and why?",
                "If you could visit with any person in history, who would it be and why?",
                "If you could do something very daring without fear, what would you do?",
                "If you could take an early retirement, what would you do?",
                "If you had the chance to go anywhere for dinner tomorrow, where would you go? Why?",
                "If you were assured you would not fail, what endeavor would you attempt?",
                "If you could be any celebrity, who would you want to become? Why?",
                "If you won a million dollars in the lottery, how would you spend it?",
                "If you could learn to speak a foreign language, which one would you choose and why?"
            ],
            "Viewpoints": [
                "What does 'success' mean to you?",
                "Do you think there will ever be world peace? Why or why not?",
                "What's the secret to a long life?",
                "Which is the greater tragedy: an innocent person imprisoned or a guilty person set free? Explain.",
                "How important is it to set personal goals?",
                "Are people trustworthy? Explain your answer.",
                "What is beauty?",
                "Why do you think people live in denial?",
                "What new law is needed to make the world a better place to live?",
                "How would you describe the perfect day?",
                "In your opinion, what is the moral condition of this world?",
                "Why do you think divorce is so prevalent?",
                "What is the ideal age to get married? Why?",
                "To what extent is knowledge power, to what extent is truth power, and what's the difference?",
                "Do you believe that the human soul is eternal?",
                "What is the greatest invention the world has ever seen?",
                "What do you think is needed to make the world a better place?",
                "What advice can you give about how to conquer fear?",
                "What advice can you give about how to relieve stress?",
                "Why are some people cruel and unkind?"
            ],
            "Hard-Hitting": [
                "What's one regret you live with?",
                "What do you live in denial about?",
                "What phobias have you struggled with?",
                "How difficult is it for you to forgive someone who refuses to apologize?",
                "What's the most serious illness or injury you ever faced?",
                "How are you different now than you were before September 11, 2001?",
                "How would you prefer to die—quickly without warning or slowly over time?",
                "What insults your intelligence?",
                "What's one conviction you hold that you would be willing to die for?",
                "When is it okay to lie?",
                "What's your most embarrassing moment?",
                "When have you had to agree to disagree? Explain.",
                "What bad habit have you broken?",
                "In an emergency, which friends would you feel the freedom to call in the middle of the night?",
                "Where are you going?",
                "What impossible task are you facing right now?",
                "What fear are you trying to overcome?",
                "Would most people describe you as humble or proud? Why?",
                "Have you ever violated a confidence? Describe what happened.",
                "Have you ever been falsely accused? Describe the situation and how you felt about it."
            ],
            "From the Heart": [
                "When was the last time you cried? Why?",
                "How would you describe a time when you felt alone in a crowd?",
                "What makes you stand to your feet and cheer?",
                "On a scale from 1 to 10, how happy do you usually feel? Explain.",
                "What's your most prized or sentimental possession? Explain.",
                "What or who inspires you to be all that you can be?",
                "When have you been overwhelmed with compassion or overcome with pity? How were you transformed by the experience?",
                "What in this world breaks your heart?",
                "If you had to locate the feeling of 'longing' or 'yearning' in your body, where would you say it was?",
                "Describe a time when you lost something very valuable. How did you feel when you finally found it or when you realized it would never be found?",
                "How do you handle anger?",
                "What stresses you out?",
                "What is something that always brings a smile to your face?",
                "What mood are you usually in? Explain why.",
                "What silly thing have you done in the name of love?",
                "When was the last time you helped someone in need? Describe it.",
                "What's one accomplishment that gives you great satisfaction?",
                "What was your proudest moment?",
                "In relationships, are you more often the 'heartbreaker' or the 'heart broken'? Why?",
                "How many times have you really been in love?"
            ],
            "Spiritually Speaking": [
                "Why do you think there are so many different religions in the world?",
                "Do you think that all the major religions are fundamentally the same or different? Explain your answer.",
                "Do you think religion is an emotional crutch for some people? Why or why not?",
                "What do you think heaven is like?",
                "What do you think most people think about the Bible?",
                "What do you think are the most common misconceptions people have about God?",
                "Do you believe the Bible is actually God's chosen tool for communication to mankind? Why or why not?",
                "Do you believe in reincarnation? Why or why not?",
                "What do you like most about church, synagogue, or mosque?",
                "Why does God seem so distant?",
                "Do you think most people are spiritually attuned or spiritually ignorant?",
                "What is your attitude toward people who believe differently than you?",
                "Do you think God exists? Why or why not?",
                "If God did not exist, what practical difference would that make in our world?",
                "Is God dead? Explain.",
                "Why do you think some people are skeptical about the existence of God? Why are others so certain he does exist?",
                "Is belief in God intellectual suicide? Why or why not?",
                "Do you think it's possible for anyone to know for sure if there is a God? Explain.",
                "Why do you think that some form of religious belief is present in virtually every culture?",
                "What do you like least about religion?"
            ],
            "Extreme Spiritual Matters": [
                "When and how often do you pray? What motivates you to pray?",
                "On a scale from 1 to 10, how close to God do you feel? Explain.",
                "Rate the level of intensity you have about wanting to know God? Explain your answer.",
                "If a dimmer switch could represent your understanding of Christianity, how bright would your light be?",
                "Has there ever been a time you were convinced you received direction from God? Describe it.",
                "How do you discern God's direction for your life?",
                "How has your belief or disbelief in God affected your life?",
                "What fears do you have about God?",
                "What makes it difficult for you to trust God?",
                "If you were to explain to a friend what it means to know God personally, what would you say?",
                "With everything in this universe that could consume God's time and energy, how much do you think God really cares about what happens in your life?",
                "What is your greatest fear about what you'd be like if God were leading your life?",
                "Why doesn't God do something about evil and suffering?",
                "When have you experienced a situation in which you believe God intervened? Describe it.",
                "What is your reaction to the Bible's claim that Jesus is the only way to God?",
                "What has been your biggest obstacle to spiritual growth?",
                "Where are you in your spiritual journey?",
                "Using the compartments of a car, how would you describe where God fits into your life (trunk, driver's seat, back seat, glove compartment, passenger seat, etc.)? Explain your answer.",
                "What prevents you from taking steps on your spiritual journey now?",
                "Who will be in heaven? Why?"
            ]
        };

        let selectedCategories = new Set();
        let questionHistory = [];
        
        let stopwatchInterval = null;
        let stopwatchTime = 0;
        let isStopwatchRunning = false;

        function toggleTheme() {
            const body = document.body;
            const themeIcon = document.getElementById('themeIcon');
            
            if (body.classList.contains('dark')) {
                body.classList.remove('dark');
                themeIcon.textContent = '☀️';
                localStorage.setItem('theme', 'light');
            } else {
                body.classList.add('dark');
                themeIcon.textContent = '🌙';
                localStorage.setItem('theme', 'dark');
            }
        }

        function toggleHistory() {
            const historyPanel = document.getElementById('historyPanel');
            historyPanel.classList.toggle('show');
        }

        function displayHistoryQuestion(category, question) {
            const questionDisplay = document.getElementById('questionDisplay');
            const cleanQuestion = cleanQuestionText(question);
            
            questionDisplay.classList.remove('placeholder-text');
            questionDisplay.innerHTML = `<strong>Category:</strong> ${category}<br><br>${cleanQuestion}`;
            toggleHistory(); // Close history panel
        }

        function updateHistoryDisplay() {
            const historyList = document.getElementById('historyList');
            
            if (questionHistory.length === 0) {
                historyList.innerHTML = '<p class="placeholder-text">No questions generated yet.</p>';
                return;
            }
            
            historyList.innerHTML = questionHistory.map((item, index) => `
                <div class="history-item" onclick="displayHistoryQuestion('${item.category}', '${item.question.replace(/'/g, "\\'")}')">
                    <div class="history-category">${item.category}</div>
                    <div class="history-question">${cleanQuestionText(item.question)}</div>
                </div>
            `).reverse().join('');
        }

        function initializeApp() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark');
                document.getElementById('themeIcon').textContent = '🌙';
            }

            const categoriesGrid = document.getElementById('categoriesGrid');
            const categories = Object.keys(questionsByCategory);
            
            categories.forEach(category => {
                const categoryItem = document.createElement('div');
                categoryItem.className = 'category-item';
                categoryItem.onclick = () => toggleCategory(category);
                
                categoryItem.innerHTML = `
                    <input type="checkbox" class="category-checkbox" id="cat-${category}" onchange="toggleCategory('${category}')">
                    <label class="category-label" for="cat-${category}">${category}</label>
                `;
                
                categoriesGrid.appendChild(categoryItem);
            });
        }

        function toggleCategory(category) {
            const checkbox = document.getElementById(`cat-${category}`);
            
            if (selectedCategories.has(category)) {
                selectedCategories.delete(category);
                checkbox.checked = false;
            } else {
                selectedCategories.add(category);
                checkbox.checked = true;
            }
            
            updateGenerateButton();
        }

        function selectAllCategories() {
            const categories = Object.keys(questionsByCategory);
            categories.forEach(category => {
                selectedCategories.add(category);
                document.getElementById(`cat-${category}`).checked = true;
            });
            updateGenerateButton();
        }

        function clearAllCategories() {
            selectedCategories.clear();
            const checkboxes = document.querySelectorAll('.category-checkbox');
            checkboxes.forEach(checkbox => checkbox.checked = false);
            updateGenerateButton();
        }

        function updateGenerateButton() {
            const generateBtn = document.getElementById('generateBtn');
            generateBtn.disabled = selectedCategories.size === 0;
        }

        function generateQuestion() {
            if (selectedCategories.size === 0) {
                showError('Please select at least one category first!');
                return;
            }

            const questionDisplay = document.getElementById('questionDisplay');
            const generateBtn = document.getElementById('generateBtn');
            
            generateBtn.disabled = true;
            generateBtn.textContent = 'Generating...';
            
            setTimeout(() => {
                // Get random category from selected ones
                const categoriesArray = Array.from(selectedCategories);
                const randomCategory = categoriesArray[Math.floor(Math.random() * categoriesArray.length)];
                
                // Get random question from that category
                const questions = questionsByCategory[randomCategory];
                const randomQuestion = questions[Math.floor(Math.random() * questions.length)];
                
                questionHistory.push({
                    category: randomCategory,
                    question: randomQuestion,
                    timestamp: new Date()
                });
                updateHistoryDisplay();
                
                // Clean up the question text
                const cleanQuestion = cleanQuestionText(randomQuestion);
                
                questionDisplay.classList.remove('placeholder-text');
                questionDisplay.innerHTML = `<strong>Category:</strong> ${randomCategory}<br><br>${cleanQuestion}`;
                
                generateBtn.disabled = false;
                generateBtn.textContent = 'Generate Question';
            }, 300); // Reduced timeout to make it feel more responsive
        }

        function cleanQuestionText(text) {
            return text
                .replace(/\\n/g, ' ')
                .replace(/\n/g, ' ')
                .replace(/\s+/g, ' ')
                .replace(/\?\s*\?/g, '?')
                .replace(/\.\s*\./g, '.')
                .replace(/\s*\?\s*Why\?/g, '? Why?')
                .replace(/\s*\?\s*Explain\./g, '? Explain.')
                .replace(/\s*\?\s*Describe/g, '? Describe')
                .trim();
        }

        function showError(message) {
            const questionDisplay = document.getElementById('questionDisplay');
            questionDisplay.innerHTML = `<div class="error-message">${message}</div>`;
            setTimeout(() => {
                questionDisplay.innerHTML = '<div class="placeholder-text">Select one or more categories and click "Generate Question" to get started!</div>';
            }, 3000);
        }

        function toggleStopwatch() {
            const stopwatchBtn = document.getElementById('stopwatchBtn');
            
            if (isStopwatchRunning) {
                // Stop the stopwatch
                clearInterval(stopwatchInterval);
                stopwatchBtn.textContent = 'Start';
                stopwatchBtn.classList.remove('active');
                isStopwatchRunning = false;
            } else {
                // Start the stopwatch
                stopwatchInterval = setInterval(updateStopwatch, 1000);
                stopwatchBtn.textContent = 'Stop';
                stopwatchBtn.classList.add('active');
                isStopwatchRunning = true;
            }
        }

        function resetStopwatch() {
            clearInterval(stopwatchInterval);
            stopwatchTime = 0;
            isStopwatchRunning = false;
            
            const stopwatchBtn = document.getElementById('stopwatchBtn');
            const stopwatchDisplay = document.getElementById('stopwatchDisplay');
            
            stopwatchBtn.textContent = 'Start';
            stopwatchBtn.classList.remove('active');
            stopwatchDisplay.textContent = '00:00';
        }

        function updateStopwatch() {
            stopwatchTime++;
            const minutes = Math.floor(stopwatchTime / 60);
            const seconds = stopwatchTime % 60;
            
            const stopwatchDisplay = document.getElementById('stopwatchDisplay');
            stopwatchDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Initialize the app when the page loads
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
